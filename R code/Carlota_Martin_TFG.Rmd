---
geometry: margin=2.5cm
header-includes: 
- \usepackage{longtable}
- \renewcommand{\baselinestretch}{1.25}
output:
  pdf_document:
    latex_engine: xelatex
    number_sections: yes
    toc: yes
    toc_depth: 3
  word_document:
    toc: yes
    toc_depth: '3'
bibliography:
- referencias.bib
csl: acm-sig-proceedings-long-author-list.csl
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
# Required packages:
library(kableExtra)
library(knitr)
library(effects)
library(car)
library(emmeans)
library(descr)
library(pastecs)
library(ggplot2)
require(gridExtra)
library(reshape2)
library(jtools)
library(huxtable)
library(emmeans)
library(effects)
library(ggstance)
library(interactions)
library(RColorBrewer)
library(mice)
library(bibtex)
library(reshape2)
library(RColorBrewer)
library(VIM)
library(cowplot)
library(multcomp)
library(metafor)
library(lme4)
```

<div style="text-align: justify">

\newpage

# List of acronyms

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center', tinytex.verbose = TRUE, comment = NA, fig.height = 4, fig.width = 7}
acronyms <- data.frame(
  "Acronym" = c("CI","EVT","FEI","FURIAS","MAR","MCAR","MNAR","MRI",  "NIHSS",  "SEN","TICI", "Tmax",  "VIF"), 
  "Description" = c("Confidence interval",
                    "Endovascular Therapy",
                    "The Spanish Stroke Federation",
                    "Futile Recanalization in Ischemic Acute Stroke",
                    "Missing at random",
                    "Missing completely at random",
                    "Missing not at random",
                    "Magnetic Resonance Imaging",
                    "National Institute of Health Stroke Scale",
                    "The Spanish Neurology Society",
                    "Thrombolysis in Cerebral Infarction",
                    "Maximum time",
                    "Variance Inflation Factor")
)

kable(acronyms, booktabs = T, row.names = FALSE, align = c("l","l"), linesep="") %>%
  kable_styling(font_size = 10, latex_options = "hold_position", position = "center",full_width=T) %>%
  row_spec(0, bold = T, color = "black") %>%
  column_spec(1, width = "2.75cm") 
```

\newpage

# Introduction

## Background

Stroke has a huge impact on society. In Spain, there are 71,780 new strokes every year. Indeed, it is currently the second cause of death in the general population and the first cause of woman's death, according to FEI @ictus1. It is also the largest cause of disability and generates a very high cost for health and social services. As reported by the SEN @ictus, stroke-related costs of a patient in Spain come to nearly 27,711 euros per year (including medical and indirect costs). Consequently,  stroke-related costs come to approximately 1,989 million euros per year. Compared with other diseases (stroke is a clinical syndrome rather than a single disease), the consumption of health care resources is higher among stroke patients. 

Moreover, two out of every three people who survive a stroke have some type of sequels, in many cases disabling, which significantly increases the need for assistance or care.

Basically, it is the leading cause of long term disability in developed countries and one of the top causes of mortality worldwide. Correct management relies on rapid diagnosis and focused treatment, thorough investigation and rehabilitation programs.

## Definition of stroke

Like all organs, the brain needs the oxygen and nutrients provided by blood to function properly. If the supply of blood is restricted or stopped, brain cells begin to die, which is what happens when strokes occur. This can lead to brain injury, disability and, in the worst scenario, death @ictus3. 

Strokes can be classified into two major categories: ischemic (due to lack of blood flow, accounting for 85% of all cases) and hemorrhagic (where a weakened blood vessel supplying the brain bursts). Both cause parts of the brain to stop functioning properly. 

Acute ischemic strokes, as mentioned before, result in loss of blood flow, nutrients and oxygen because one of the arteries in the brain is blocked. Consequently, the brain receives less blood than it needs to work normally. There are two revascularization procedures to restore blood flow: the intravenous fibrinolysis, which consists of dissolving the thrombus (blood clot) that occludes the artery with a medicinal product applied intravenously, and the mechanical thrombectomy, which is based on removing the thrombus with the help of a catheter. A successful treatment allows the blood to re-nourish the affected part of the brain and increases the chances that the patient will have a favorable situation after the stroke @ictus2.

Furthermore, the severity of a stroke depends on which blood vessels are affected. A blockage or a rupture in one of the main arteries that supplies the brain will cause widespread damage and severe loss function. A blockage in a minor branch of an artery will cause less damage and a full recovery is more likely, although this can depend on the importance of the brain cells that have been damaged. 

The degree of recovery that a patient can achieve after a stroke is variable and depends on the initial size of the brain lesion, the success of the procedure (evaluated using TICI grading system @art1), which parts of the brain were affected, what type of blood vessel was involved and other individual variables that are currently not well known. 

It is important to mention that there are two groups of TICI grades; TICI grades less than 2b and TICI grades greater than or equal to 2b. On the one hand, TICI grades less than 2b are TICI 0 (no reperfusion), TICI 1 (perfusion past the initial obstruction, but a limited distal branch, filling with little or slow distal perfusion) and TICI 2a (perfusion of $<$ 50% of the vascular distribution of the occluded artery). These ones are used when unsuccessful recanalization. On the other hand, TICI grades greater than or equal to 2b are TICI 2b (perfusion of $\geq$ 50% of the vascular distribution of the occluded artery), TICI 2c (near-complete perfusion without clearly visible thrombus but with delay in contrast run-off) and TICI 3 (complete perfusion). These ones are used when successful recanalization. In conclusion, greater TICI grades mean more success of the procedure (less severe brain injury).

&nbsp;

```{r echo=FALSE, fig.align="center",out.width='70%', fig.cap="TICI grading system"}
knitr::include_graphics('F:/TFG/TICIII.jpg')
```

Recanalization is sometimes not achieved even after multiple passes of the catheter. Whether revascularization becomes futile or harmful with an increasing number of passes as well as criteria for when to halt attempting recanalization remain unknown. Despite this, the final conclusion of a study of the American Heart Association was that the likelihood of successful recanalization got sequentially lower as the number of passes increased. Besides, it is known that the number of passes needed to achieve target vessel recanalization modifies the outcome after mechanical thrombectomy and successful recanalization after a single pass is associated with favorable outcome.

## Objectives

In order to describe the goals of this end-of-degree project, it is necessary to explain what the FURIAS project consists of. The FURIAS project was designed to study the radiological factors associated with futile recanalization after endovascular treatment in acute stroke. Its general objective is to find signs in the neuroimages obtained in MRI scans that can help predict the success of the procedure and the degree of clinical recovery of stroke patients. 

Consequently, a prospective observational study is designed in which 3 serial MRI scans are performed on 98 stroke patients undergone mechanical thrombectomy. From the MRI scans a detailed picture of the brain is obtained. It is important to mention that all the neuroimages are de-identified, pseudomized and stored for analysis. An expert reader, blinded to the clinical data, is in charge of segmenting by hand hyperintensities on diffusion weighted imaging creating lesions marks on MRI scans (Figure 2 @maria).

```{r echo=FALSE, fig.align="center",out.width='50%', fig.cap="MRI scans of acute stroke patients"}
knitr::include_graphics('F:/TFG/MRI2.JPEG')
```

\newpage 

In the first MRI scan, done on arrival at the hospital (Infarct volume pre EVT) it can be assessed the size of the initial infarction. The second MRI is performed after mechanical thrombectomy where it can be seen the size of the infarct after the procedure (Infarct volume post EVT). In addition, a third MRI performed 5 days after the mechanical thrombectomy (Infarct volume on day 5), shows the final infarction.

* Initial infarct size = Infarct volume pre EVT
* Post-procedure infarct size = Infarct volume post EVT
* Final infarct size = Infarct volume on day 5

First, the difference between infarct volume on day 5 and infarct volume pre EVT is called *total infarct growth*. Second, the difference between infarct volume post EVT and infarct volume pre EVT is called *early infarct growth*. Last, the difference between infarct volume on day 5 and infarct volume post EVT is called *late infarct growth*.

* Early infarct growth = post - pre
* Late infarct growth = 5d - post
* Total infarct growth = 5d - pre = Early infarct growth + Late infarct growth

The specific objective of this end-of-degree project, which is a substudy framed in the FURIAS project, is to study the evolution of the size of the infarct (evaluated as diffusion lesion) at different time points (pre-procedure on arrival at the hospital, immediately after the procedure and after five days) and to understand which factors are associated with infarct volume growth.

\newpage

# Methodology

## Variable definition

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE}
definition <- data.frame(
  "Variable" = c("Good collaterals","HIR pre", "Infarct volume pre EVT", "Infarct volume post EVT","Infarct volume on day 5", "Number of passes",  "TICI grade","TMax6 volume post" ), 
  "Description" = c("Good collateral circulation", "Hypoperfusion intensity ratio", "Initial infarct size", "Post-procedure infarct size", "Final infarct size", "Number of passes of the catheter needed to achieve target vessel recanalization", "TICI grading system", "Time to maximum > 6 volume")
)

kable(definition, booktabs = T, row.names = FALSE, align = c("l","l"), linesep="") %>%
  kable_styling(font_size = 8, latex_options = "hold_position", position = "center",full_width=T) %>%
  row_spec(0, bold = T, color = "black") %>%
  column_spec(1, width = "4cm") 
```

## Descriptive analysis

A descriptive analysis of the baseline patient's characteristics is performed. For categorical variables, frequencies and percentages are provided. For symmetric continuous variables, mean and standard deviation are shown. However, if the variable is skewed, median and IQR (first and third quartiles) are provided. In addition, some visual representations (box plots, scatter plots, to name a few) of the distribution of infarct volumes are presented.

Furthermore, a numerical and graphical descriptive analysis are performed for the infarct and hypoperfusion volumes and infarct growths stratifying by TICI grade.

The correlation between infarct growths and relevant continuous variables are calculated using the (non-parametric) Spearman’s correlation coefficient. On the contrary, for dichotomous variables, Pearson's correlation coefficient is shown (as there are only two categories, polyserial and Pearson's correlations match). 

## Imputation for missing data

Leaving out subjects with some missing data deprives of some amount of information. For this reason, a multiple missing imputation, which is a technique for dealing with missing data, is used. Basically, it imputes the data with plausible values based on the information provided by the other variables. 

It is important to mention that missing data are typically grouped into three categories @book1:

* MCAR: if the probability of being missing is the same for all cases. This effectively implies that the causes of the missing data are unrelated to the data. When data are MCAR, the complete case analysis performed on the data is unbiased; however, is generally regarded as a strong and often unrealistic assumption because data are rarely MCAR.

* MAR: if the probability of being missing is the same only within groups defined by the observed data. Modern missing data methods generally start from the MAR assumption. The complete data can provide, but not necessarily, asymptotically unbiased estimates.

* MNAR: if the probability of being missing varies for reasons that are unknown; the missingness is related to factors which are not measured by the researcher. Basically, it is data that is neither MAR nor MCAR.

There are multiple ad-hoc solutions, such as a listwise deletion (complete case analysis), pairwise deletion, mean imputation, regression imputation and multiple imputation, to name a few. Assuming the data is not MCAR, multiple imputation was applied in our work.

Multiple imputation always follows three steps: imputation, analysis and pooling (Figure 3, inspired by @art4). Multiple imputation creates several complete versions of the data by replacing the missing values by plausible data values. These plausible values are drawn from a distribution specifically modeled for each missing entry, this step is known as *imputation*. At the end of this step, there are _m_ completed datasets. The _m_ imputed datasets are identical for the observed data entries, but differ in the imputed values. Then these datasets are analyzed in the *analysis* step. Then estimates the parameters of interest from each imputed dataset and pools those parameters into one estimate in the *pooling* step. Under the appropriate conditions, the pooled estimates are unbiased and have the correct statistical properties @book5. 

In this particular case, assuming the data is not MNAR, MICE @art2 (Multiple imputation by chained equations), which is a particular multiple imputation technique, is used. It is important to mention that this robust method, imputes missing data in a dataset through an iterative series of predictive models. In each iteration, each specified variable in the dataset is imputed using the other variables in the dataset. It is a very flexible method and can handle variables of varying types. 

&nbsp;

```{r echo=FALSE, out.width='60%', fig.cap="Steps of multiple imputation", fig.align="center"}
knitr::include_graphics('F:/TFG/INCOMPLETE.jpg')
```

## Statistical modelling

To begin with, to study the evolution of the size of the infarct at different time points, general linear models are first applied due to their simplicity. Within these, the infarct growths are first modeled, as requested by the researcher, but the analysis adjusting by baseline values is more efficient than the one that considers the difference over time as the response @book2. For this reason, the infarct volumes, applying the logarithmic transformation, are modeled. Then, the generalized linear models are used to see if the logarithmic transformation could be spared to make the models easier to interpret. Finally, a mixed model is implemented to consider the correlations between the measures corresponding to the same patient. Also, a logarithmic transformation to the infarct volumes is done. Mixed models provide an analytical power that cannot be achieved using the previously indicated methods.

Since logarithms are applied in general linear models using infarct volumes and in the mixed model, the effects on the response variable are multiplicative. In contrast, for the remaining models, the effects are additive.

### General linear models

The general linear model usually refers to conventional linear regression, which is a statistical method used to describe the relationship between a continuous random variable Y, known as the response variable, and a group of k non-random variables X, known as predictors. The general equation for a linear model is:
$$Y=X\beta+\epsilon $$
$$ Y = (y_1,...,y_n)'$$
$$\beta=(\beta_0, \beta_1,...,\beta_k)' $$
$$\epsilon=(\epsilon_1,...,\epsilon_n)' $$

Where Y is a vector of observations, X is a matrix of known covariates, $\beta$ is a vector of the coefficients and $\epsilon$ is a vector of error terms.

In the general linear model, the following is assumed:
$$\epsilon_i \sim N(0,\sigma^2)$$

Basically, the general linear model is used when the response variable and error term follow a Normal distribution, the relationship between response and explanatory variable is linear, errors are homoscedastic and non-correlated and, finally, independent explanatory variables are not correlated.

### Generalized linear models

The generalized linear model is a flexible generalization of the general linear model so that the dependent variable is linearly related to the factors and covariates via a specified link function. The model also allows for the dependent variable to have a non-normal distribution. Basically, a generalized linear model consists of three components @book3:

* A linear predictor which is a linear function of regressors:
$$ \eta = X\beta  $$

* A link function (g) which is a bijective function that relates the expected value to the linear predictor:
$$ g(\mu) = \eta=X\beta$$
$$ \mu =g^{-1}(\eta)=g^{-1}(X\beta)$$

* An exponential family of probability distributions:
$$ f_{Yi}=(y;\theta_i;\phi)= e^{\frac{\theta_iy-b(\theta_i)}{a(\phi)}+c(y,\phi)} $$

Both statistical methods, general and generalized linear models, relate some predictors to a single outcome variable. The main difference between them is that the general linear models assume that the residuals follow a conditionally normal distribution, while the generalized linear models loosens this assumption and allows for a variety of other distributions from the exponential family for the residuals, so the sampling distribution of the residuals need to be specified. In this study, Gamma family and link identity are used. In the particular case that the link function is the identity function and the distribution of errors is normal generalized and general linear models provide the same fit.

### Mixed model 

Linear mixed models are an extension of simple linear models to allow both fixed and random effects. These models are particularly useful when analyzing repeated measures in which the response is continuous and measured in multiple occasions at several time points. As observations are collected from the same individuals over time, it may be reasonable to assume that there is some kind of correlation among the observations from the same individual. Linear mixed models are useful for modeling the correlations among the observations of the same patient. Therefore, a random intercept mixed model is done because time is considered to be categorical (time points depend on the duration of each patient's procedure). The general equation for a linear mixed model is @art3:
$$Y=X\beta+Zu+\epsilon$$
Where Y is a vector of observations, X is a matrix of known covariates associated with the fixed effects, $\beta$ is a vector of the fixed effects, Z is a matrix associated with the random effects, u is a vector of random effects and $\epsilon$ is a vector of errors. 

## Variable selection

In the multivariate linear models with infarct growths or volumes, relevant variables in the univariate models are candidates to be included in the multivariate models. Each of these variables and their interactions with the TICI grade are tested using the F test (function anova, package stats for R), which provided the final model. 

For the selection of variables in the multivariate generalized linear models with infarct volumes, same procedure mentioned above is carried out, but using the deviance test. The variables that caused convergence problems with the model are not included.

Furthermore, for the selection of variables in the mixed model, relevant variables from the other models are included. Nevertheless, those variables post-procedure for which baseline values are not available are not included in the model.

Automatic selection methods such as stepwise are avoided because of their propensity to provide biased results @book4.

It is worth mentioning that the number of passes is dichotomized in general linear models using infarct growth, as requested by the researcher, and for the generalized linear models. In contrast, for the remaining models, the number of passes is considered numerical.

Finally, the Variance Inflation Factor is calculated for each variable in each model to measure the collinearity. For the VIF, a cutoff point of three was determined to detect high collinearities.

## Model outputs

For each model, a table with all the coefficients obtained and their 95% CI are provided. To ease the interpretation, an analogue table with these coefficients untransformed according to the data response is also given, if pertinent. For continuous predictors, expected response values are given for the minimum, the median and the maximum values of the predictor's value in the sample. For the factors, expected response values are presented for each category. In both variable types, predictions are provided for each category of the response. In addition, forest plots for the 95% CI of the associations between predictors and response are shown. Finally, graphics pointing out the relationship of the response with each predictor are displayed.  

## Model validation

To validate all the models, the graphic of residuals versus fitted values is provided. This plot is used to detect non-linearity, unequal error variances and outliers. First, it can be assumed that the relationship is linear if the residuals are randomly distributed around the residual line. Second, it can be accepted that the variances of the error terms are equal if the residuals roughly (raw residuals in general linear models and Pearson residuals in the generalized linear models) form a horizontal band along the axis of fitted values. Finally, it can be regarded that there are no outliers if any residual stands out from the basic random pattern of residuals. 

In case of the presence of outliers, the Cook's distance; which is a measure to detect if there are observations that have a real
influence on the fit, the studentized residuals; which are a measure to detect outliers, and the hat-values; whose aim is to
highlight a priori influential observations, are provided. Besides, an outlier test is done to verify that these observations are indeed outliers.

Additionally, the coefficient of determination (R-squared) is provided for each model. This coefficient measures the proportion of the total variability of the endogenous variable is explained by the model. Basically, it gives some information about the goodness of fit of a model. For the generalized linear models, the Cragg-Uhler R-squared is provided instead.

## Software 

To carry out the analysis, the statistical software that is used in this end-of-degree project is R (R version 3.6.2). In order to turn the analyses into a report, R Markdown is used. Also, different packages, such as _jtools_ @jtools, _mice_ @mice, _emmeans_ @emmeans and _effects_ @effects, related to the modelling and visualization of data are used and specified in the code. The code used is uploaded in GitHub and is provided in following link: 

https://github.com/carlotapmartin/TFG_FURIAS_study

\newpage

```{r message=FALSE, warning=FALSE, include=FALSE}
# Load data:
require(foreign)
d <- read.spss("FURIAS_DWI_evolution_Jordi.sav", to.data.frame=TRUE)

# Create variable total infarct growth:
d$"Total_infarct_growth" <- d$V_5d-d$V_pre_EVT

# Dichotomize categorical variables into numerical:
d$Good_collaterals <- ifelse(d$Good_collaterals=="no", c(0), c(1))
d$complicaciones2 <- ifelse(d$complicaciones2=="No", c(0), c(1))
d$TICI_equal_higher2B <- ifelse(d$TICI_equal_higher2B=="no", c(0), c(1))
d$oclus_post_EVT <- ifelse(d$oclus_post_EVT=="no", c(0), c(1))
d$sexo <- ifelse(d$sexo=="hombre", c(0), c(1))

# Changing a values from different pacients:
d$V_5d[10] <- c(373)
d$V_pre_EVT[86] <-c(2.096)
```

```{r eval=FALSE, include=FALSE}
# Summary of the database:
summary(d)
```

```{r message=FALSE, warning=FALSE, comment=F, include=FALSE}
# Loading data because variable sedation was not included in the previous one:
d_sed <- read.spss("sedacion_FURIAS.sav", to.data.frame=TRUE)
```

```{r message=FALSE, warning=FALSE, include=FALSE}

#####################################
# TABLE 1 ~ BASELINE CHARACTERISTICS:
#####################################

table1_col1 <- c("Age (years)", "Sex (male)", "Smoking", "Hypertension", "Dyslipidemia", "Diabetes",
              "Atrial fibrillation", "", "Atheroembolic", "Cardioembolic", "Undetermined","",
              "Onset to admission (min)", "Baseline NIHSS", "Baseline Glycemia", "Wake up stroke",
              "", "Intracranial carotid", "Tandem", "MCA M1 segment", "MCA M2 segment","",  "Previous intravenous alteplase", "Onset to groin (min)", "Conscious sedation","","TICI 0",
              "TICI 2a", "TICI 2b", "TICI 2c", "TICI 3")

table1_col2 <- c(
  (paste(round(mean(d$age),1), "±" , round(sd(d$age),1))),
  (paste(freq(d$sexo, plot=F)[1], "(", round(freq(d$sexo, plot=F)[1,2],1), "%", ")")),
  (paste(freq(d$tabaq, plot=F)[2], "(", round(freq(d$tabaq, plot=F)[2,2],1), "%", ")")),
  (paste(freq(d$hta, plot=F)[2], "(", round(freq(d$hta, plot=F)[2,2],1), "%", ")")),
  (paste(freq(d$dislipem, plot=F)[2], "(", round(freq(d$dislipem, plot=F)[2,2],1), "%",")")),
  (paste(freq(d$dmellitu, plot=F)[2], "(", round(freq(d$dmellitu, plot=F)[2,2],1), "%", ")")),
  (paste(freq(d$acxfa, plot=F)[2], "(", round(freq(d$acxfa, plot=F)[2,2],1), "%", ")")),
  "",
  (paste(freq(d$categcl=="Large-artery atherosclerosis", plot=F)[2], "(", 
         round(freq(d$categcl=="Large-artery atherosclerosis", plot=F)[2,2],1), "%", ")")),
  (paste(freq(d$categcl=="Cardioembolism", plot=F) [2], "(",
         round(freq(d$categcl=="Cardioembolism", plot=F)[2,2],1), "%", ")")),
  (paste(freq(d$categcl=="Stroke of undetermined etiology", plot=F) [2], "(",
              round(freq(d$categcl=="Stroke of undetermined etiology", plot=F)[2,2],1), "%", ")")),
  "",
  (paste(round(summary(d$ini_lle)["Median"][[1]],0), "[", round(summary(d$ini_lle)["1st Qu."][[1]],0), ",",
         round(summary(d$ini_lle)["3rd Qu."][[1]],0), "]")),
  (paste(round(summary(d$Baseline_NIHSS)["Median"][[1]],0), "[", 
         round(summary(d$Baseline_NIHSS)["1st Qu."][[1]],0),
         ",", round(summary(d$Baseline_NIHSS)["3rd Qu."][[1]],0), "]")),
  (paste(round(summary(d$Baseline_glycemia)["Median"][[1]],0), "[", 
         round(summary(d$Baseline_glycemia)["1st Qu."][[1]],0), ",", 
         round(summary(d$Baseline_glycemia)["3rd Qu."][[1]],0), "]")),
  (paste(freq(d$despertar, plot=F)[2], "(", round(freq(d$despertar, plot=F)[2,2],1), "%", ")")),
  "",
  (paste(freq(d$arteria_ocluida=="TICA (ACI terminal)", plot=F)[2]+
         freq(d$arteria_ocluida=="ACI proximal", plot=F)[2], "(",
         round(freq(d$arteria_ocluida=="TICA (ACI terminal)",
         plot=F)[2,2]+freq(d$arteria_ocluida=="ACI proximal", plot=F)[2,2],1), "%", ")")),
  (paste(freq(d$arteria_ocluida=="Tandem (ACI+ACM)", plot=F)[2]+
         freq(d$arteria_ocluida=="Tandem (ICA + TICA)", plot=F)[2]+
         freq(d$arteria_ocluida=="Tandem (ACI+M2)", plot=F)[2], "(",
         round(freq(d$arteria_ocluida=="Tandem (ACI+ACM)",plot=F)[2,2]+
         freq(d$arteria_ocluida=="Tandem (ICA + TICA)", plot=F)[2,2]+
         freq(d$arteria_ocluida=="Tandem (ACI+M2)", plot=F)[2,2],1), "%", ")")),
  paste(freq(d$arteria_ocluida=="M1 ACM", plot=F) [2], "(", round(freq(d$arteria_ocluida=="M1 ACM",
         plot=F)[2,2],1),"%", ")"),
  paste(freq(d$arteria_ocluida=="M2 ACM", plot=F) [2], "(", round(freq(d$arteria_ocluida=="M2 ACM",
         plot=F)[2,2],1),"%", ")"),
  "",
  paste(freq(d$TTO=="tPA ev+TEV", plot=F) [2], "(", round(freq(d$TTO=="tPA ev+TEV",
         plot=F)[2,2],1),"%", ")"),
  (paste(round(summary(d$ini_gp)["Median"][[1]],0), "[", round(summary(d$ini_gp)["1st Qu."][[1]],0), ",",
         round(summary(d$ini_gp)["3rd Qu."][[1]],0), "]")),
  paste(freq(d_sed$anestesia=="sedación consciente", plot=F) [2], "(", round(freq(d_sed$anestesia=="sedación consciente",
         plot=F)[2,2],1),"%", ")"), 
  "",
  paste(freq(d$tici_fin=="TICI 0", plot=F) [2], "(", round(freq(d$tici_fin=="TICI 0",
         plot=F)[2,2],1),"%", ")"),
  paste(freq(d$tici_fin=="TICI 2a", plot=F) [2], "(", round(freq(d$tici_fin=="TICI 2a",
         plot=F)[2,2],1),"%", ")"),
  paste(freq(d$tici_fin=="TICI 2b", plot=F) [2], "(", round(freq(d$tici_fin=="TICI 2b",
         plot=F)[2,2],1),"%", ")"),
  paste(freq(d$tici_fin=="TICI 2c", plot=F) [2], "(", round(freq(d$tici_fin=="TICI 2c",
         plot=F)[2,2],1),"%", ")"),
  paste(freq(d$tici_fin=="TICI 3", plot=F) [2], "(", round(freq(d$tici_fin=="TICI 3",
         plot=F)[2,2],1),"%", ")"))

table1 <- data.frame(table1_col1, table1_col2)
colnames(table1) <- c("", paste("Total sample ( n =", nrow(d), ")"))
```

# Results

First, an univariate and a bivariate descriptive analysis are done. Besides, the summary of the general linear models, the generalized linear models and mixed models, that are done to evaluate the evolution of infarct growth or volumes, are shown. 

The several types of models are organized as presented in the following table:

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center', tinytex.verbose = TRUE, comment = NA, fig.height = 4, fig.width = 7}
results_col1 <- c("4.2.2", "4.2.3", "4.3", "4.4")
results_col2 <- c("General Linear model", "General Linear model", 
                    "Generalized Linear model","Mixed model")
results_col3 <- c("Infarct growths", "Infarct volumes", 
                 "Infarct volumes", "Infarct volumes (all time points)" )

results <- data.frame(results_col1, results_col2, results_col3)
colnames(results) <- c("Section","Type of model","Response")

kable(results, booktabs = T, row.names = FALSE, align = c("l","l", "l"), linesep="") %>%
  kable_styling(font_size = 8, latex_options = "hold_position", position = "center") %>%
  row_spec(0, bold = T, color = "black") %>%
  column_spec(1, width = "2.75cm") 
```

## Descriptive analysis

### Univariate descriptive analysis

A descriptive analysis of the baseline patient's characteristics is performed. Approximately 58% of the patients are men, which indicates that the patients are quite balanced according to gender. The age of the patients ranges from 38 to 92 years with a mean age of 69.83 years. In this study, the prevalence of diabetes is 16.3% and 67 patients (68.4%) have hypertension. In addition, more than half of the patients have the occlusion located in the MCA M1 segment. It is also important to mention that only 14 (14.29%) patients have TICI grade less than 2b, which means that the recanalization was not successful (Table 1).

&nbsp;

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
knitr::kable(table1, align= c('l', 'c'), caption = "Baseline characteristics", booktabs = T, longtable=T,linesep="") %>%
  kable_styling(latex_options = c("hold_position", "repeat_header"),  stripe_index = c(), font_size = 8, full_width=F) %>%
  row_spec(0, bold=T, color= "black") %>%
  pack_rows("Stroke etiology", 9, 11, bold=T) %>%
  pack_rows("Site of occlusion", 18, 21, bold=T) %>%
  pack_rows("TICI grade", 27, 31, bold=T) %>%
  footnote(number=c("For quantitative variables, ± is used for showing mean ± standard deviation in symmetric variables", "For the remaining variables, median [IQR] is provided instead"))
```

Infarct volume on day 5 has a higher median and variability than those infarct volumes observed before and immediately after the procedure. For instance, the median is almost 12 mL for infarct volume pre EVT, 20 mL for infarct volume post EVT and 25 mL for infarct volume on day 5 (Figure 4).

```{r echo=FALSE, message=FALSE, warning=FALSE, comment=F, fig.align="center", tinytex.verbose=TRUE, fig.height=2.5, fig.width=6, fig.cap="Distribution of infarct volumes (pre-procedure, post-procedure and on day 5)"}

##############################################
# FIGURE 3 ~ Distributions of infarct volumes:
##############################################

d_melted <- melt(d[c(1,2,3,4,9)], id.vars=c("ID_FURIAS", "tici_fin"))
colnames(d_melted)[1] <- c("id")

ggplot(d_melted, aes(x=variable, y=value, fill=variable)) + 
  geom_boxplot() + theme(legend.position="none")+
  labs(title="", y="mL", x="Infarct volumes")+ scale_x_discrete(labels=c("Pre", "Post", "5d"))+
  scale_fill_brewer(palette="Blues")
```

For patients with TICI grades less than 2b, the volume of the infarct growth tends to grow over the three time points. However, for TICI grades greater than or equal to 2b, the volume of the infarct growth tends to remain constant (Figure 5). An alternative representation can be found in the Appendix 1 (Figure 43), which shows infarct volumes for each TICI grade (not dichotomized). 

```{r message=FALSE, warning=FALSE, include=FALSE}

#############################
# FIGURE 4 ~ Infarct volumes:
#############################

d_melted2 <- melt(d[c(1,2,3,4,14)], id.vars=c("ID_FURIAS", "TICI_equal_higher2B"))
colnames(d_melted2)[1] <- c("id")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.height=2, fig.width=6, fig.cap="Infarct volumes for each patient stratified by TICI grade"}
ggplot(d_melted2, aes(variable, value, group=factor(id), colour=as.factor(TICI_equal_higher2B))) + geom_line() + theme(legend.position="none") + geom_point() + 
  labs(title="", y="mL", x="") + scale_x_discrete(labels=c("Pre", "Post", "5d"))+
  facet_wrap(.~TICI_equal_higher2B, labeller=labeller(TICI_equal_higher2B = c("0" = "TICI<2b", "1" = "TICI>=2b"))) + 
  scale_colour_manual(values = brewer.pal(9, "Blues")[c(9,6)])
```

On the top three plots of figure 6, it can be seen that the variability of the points is not constant along the regression line, which means that there is heteroscedasticity. To correct this, infarct volumes are log-transformed (see bottom plots of figure 6) in the general linear models. 

```{r include=FALSE}

#############################
# FIGURE 5 ~ Infarct volumes:
#############################

my_blue <- brewer.pal(n = 9, "Blues")[c(9)]

scatterplot3 <- ggplot(d, aes(x=V_pre_EVT, y=V_post_EVT)) + 
  geom_point(colour=my_blue)+
  geom_smooth(method=lm, color=my_blue)+ 
  labs(title="", x="Pre", y="Post") + ylim(0,400) + xlim(0,175)

scatterplot4 <- ggplot(d, aes(x=V_post_EVT, y=V_5d)) + 
  geom_point(colour=my_blue)+
  geom_smooth(method=lm, color=my_blue)+ 
  labs(title="", x="Post", y="5d") + ylim(0,400) + xlim(0,175)

scatterplot5 <- ggplot(d, aes(x=V_pre_EVT, y=V_5d)) + 
  geom_point(colour=my_blue)+
  geom_smooth(method=lm, color=my_blue)+ 
  labs(title="", x="Pre", y="5d") + ylim(0,400) + xlim(0,175)
```

```{r echo=FALSE, fig.align="center", fig.width=7, message=FALSE, warning=FALSE, comment=NA, fig.height=4, tinytex.verbose=TRUE, fig.cap="Scatter plots of infarct volumes (pre-procedure, post-procedure and on day 5)"}
grid.arrange(arrangeGrob(scatterplot3, scatterplot4, scatterplot5, ncol=3),
             arrangeGrob(scatterplot3+scale_x_log10()+scale_y_log10()+labs(x="log(Pre)", y="log(Post)"), scatterplot4+scale_x_log10()+scale_y_log10()+labs(x="log(Post)", y="log(5d)"), scatterplot5+scale_x_log10()+scale_y_log10()+labs(x="log(Pre)", y="log(5d)"), ncol=3),nrow=2)
```

```{r include=FALSE}
# quantile(d$V_post_EVT[d$tici_fin=="TICI 0"], type=6) -> SPSS

#######################
# TABLE 2 ~ TICI GRADE:
#######################

table2_col1 <- c("Infarct volume pre EVT", "Tmax6 volume pre","", "Infarct volume post EVT", "TMax6 volume post", "","Infarct volume 5 days","",
               "Early infarct growth", "Late infarct growth", "Total infarct growth")

table2_col2 <- c(
  paste(round(summary(d$V_pre_EVT[d$tici_fin=="TICI 0"])["Median"][[1]],0), "[",
        round(summary(d$V_pre_EVT[d$tici_fin=="TICI 0"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_pre_EVT[d$tici_fin=="TICI 0"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 0"])["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 0"])["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 0"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_post_EVT[d$tici_fin=="TICI 0"])["Median"][[1]],0), "[",
        round(summary(d$V_post_EVT[d$tici_fin=="TICI 0"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_post_EVT[d$tici_fin=="TICI 0"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 0"])["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 0"])["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 0"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_5d[d$tici_fin=="TICI 0"])["Median"][[1]],0), "[",
        round(summary(d$V_5d[d$tici_fin=="TICI 0"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_5d[d$tici_fin=="TICI 0"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 0"])["Median"][[1]],0), "[",
        round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 0"])["1st Qu."][[1]],0), ",",
        round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 0"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 0"])["Median"][[1]],0), "[",
        round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 0"])["1st Qu."][[1]],0), ",",
        round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 0"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 0"])["Median"][[1]],0), "[",
        round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 0"])["1st Qu."][[1]],0), ",",
        round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 0"])["3rd Qu."][[1]],0), "]"))

table2_col3 <- c(
  paste(round(summary(d$V_pre_EVT[d$tici_fin=="TICI 2a"])["Median"][[1]],0), "[",
        round(summary(d$V_pre_EVT[d$tici_fin=="TICI 2a"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_pre_EVT[d$tici_fin=="TICI 2a"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 2a"])["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 2a"])["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 2a"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_post_EVT[d$tici_fin=="TICI 2a"])["Median"][[1]],0), "[",
        round(summary(d$V_post_EVT[d$tici_fin=="TICI 2a"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_post_EVT[d$tici_fin=="TICI 2a"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 2a"])["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 2a"])["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 2a"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_5d[d$tici_fin=="TICI 2a"])["Median"][[1]],0), "[",
        round(summary(d$V_5d[d$tici_fin=="TICI 2a"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_5d[d$tici_fin=="TICI 2a"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 2a"])["Median"][[1]],0), "[",
        round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 2a"])["1st Qu."][[1]],0), ",",
        round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 2a"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 2a"])["Median"][[1]],0), "[",
        round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 2a"])["1st Qu."][[1]],0), ",",
        round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 2a"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 2a"])["Median"][[1]],0), "[",
        round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 2a"])["1st Qu."][[1]],0), ",",
        round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 2a"])["3rd Qu."][[1]],0), "]"))

table2_col4 <- c(
  paste(round(summary(d$V_pre_EVT[d$tici_fin=="TICI 2b"])["Median"][[1]],0), "[",
        round(summary(d$V_pre_EVT[d$tici_fin=="TICI 2b"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_pre_EVT[d$tici_fin=="TICI 2b"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 2b"])["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 2b"])["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 2b"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_post_EVT[d$tici_fin=="TICI 2b"])["Median"][[1]],0), "[",
        round(summary(d$V_post_EVT[d$tici_fin=="TICI 2b"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_post_EVT[d$tici_fin=="TICI 2b"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 2b"])["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 2b"])["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 2b"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_5d[d$tici_fin=="TICI 2b"])["Median"][[1]],0), "[",
        round(summary(d$V_5d[d$tici_fin=="TICI 2b"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_5d[d$tici_fin=="TICI 2b"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 2b"])["Median"][[1]],0), "[",
        round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 2b"])["1st Qu."][[1]],0), ",",
        round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 2b"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 2b"])["Median"][[1]],0), "[",
        round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 2b"])["1st Qu."][[1]],0), ",",
        round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 2b"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 2b"])["Median"][[1]],0), "[",
        round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 2b"])["1st Qu."][[1]],0), ",",
        round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 2b"])["3rd Qu."][[1]],0), "]"))
  
table2_col5 <- c(
  paste(round(summary(d$V_pre_EVT[d$tici_fin=="TICI 2c"])["Median"][[1]],0), "[",
        round(summary(d$V_pre_EVT[d$tici_fin=="TICI 2c"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_pre_EVT[d$tici_fin=="TICI 2c"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 2c"])["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 2c"])["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 2c"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_post_EVT[d$tici_fin=="TICI 2c"])["Median"][[1]],0), "[",
        round(summary(d$V_post_EVT[d$tici_fin=="TICI 2c"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_post_EVT[d$tici_fin=="TICI 2c"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 2c"])["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 2c"])["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 2c"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_5d[d$tici_fin=="TICI 2c"])["Median"][[1]],0), "[",
        round(summary(d$V_5d[d$tici_fin=="TICI 2c"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_5d[d$tici_fin=="TICI 2c"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 2c"])["Median"][[1]],0), "[",
        round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 2c"])["1st Qu."][[1]],0), ",",
        round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 2c"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 2c"])["Median"][[1]],0), "[",
        round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 2c"])["1st Qu."][[1]],0), ",",
        round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 2c"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 2c"])["Median"][[1]],0), "[",
        round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 2c"])["1st Qu."][[1]],0), ",",
        round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 2c"])["3rd Qu."][[1]],0), "]"))

table2_col6 <- c(
  paste(round(summary(d$V_pre_EVT[d$tici_fin=="TICI 3"])["Median"][[1]],0), "[",
        round(summary(d$V_pre_EVT[d$tici_fin=="TICI 3"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_pre_EVT[d$tici_fin=="TICI 3"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 3"])["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 3"])["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_pre_EVT[d$tici_fin=="TICI 3"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_post_EVT[d$tici_fin=="TICI 3"])["Median"][[1]],0), "[",
        round(summary(d$V_post_EVT[d$tici_fin=="TICI 3"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_post_EVT[d$tici_fin=="TICI 3"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 3"])["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 3"])["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_post_EVT[d$tici_fin=="TICI 3"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_5d[d$tici_fin=="TICI 3"])["Median"][[1]],0), "[",
        round(summary(d$V_5d[d$tici_fin=="TICI 3"])["1st Qu."][[1]],0), ",",
        round(summary(d$V_5d[d$tici_fin=="TICI 3"])["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 3"])["Median"][[1]],0), "[",
        round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 3"])["1st Qu."][[1]],0), ",",
        round(summary(d$Early_infarct_growth[d$tici_fin=="TICI 3"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 3"])["Median"][[1]],0), "[",
        round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 3"])["1st Qu."][[1]],0), ",",
        round(summary(d$Late_infarct_growth[d$tici_fin=="TICI 3"])["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 3"])["Median"][[1]],0), "[",
        round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 3"])["1st Qu."][[1]],0), ",",
        round(summary(d$Total_infarct_growth[d$tici_fin=="TICI 3"])["3rd Qu."][[1]],0), "]"))

table2_col7 <- c(
  paste(round(summary(d$V_pre_EVT)["Median"][[1]],0), "[",
        round(summary(d$V_pre_EVT)["1st Qu."][[1]],0), ",",
        round(summary(d$V_pre_EVT)["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_pre_EVT)["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_pre_EVT)["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_pre_EVT)["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_post_EVT)["Median"][[1]],0), "[",
        round(summary(d$V_post_EVT)["1st Qu."][[1]],0), ",",
        round(summary(d$V_post_EVT)["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$TMax_6s_post_EVT)["Median"][[1]],0), "[",
        round(summary(d$TMax_6s_post_EVT)["1st Qu."][[1]],0), ",",
        round(summary(d$TMax_6s_post_EVT)["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$V_5d)["Median"][[1]],0), "[",
        round(summary(d$V_5d)["1st Qu."][[1]],0), ",",
        round(summary(d$V_5d)["3rd Qu."][[1]],0), "]"),
  "",
  paste(round(summary(d$Early_infarct_growth)["Median"][[1]],0), "[",
        round(summary(d$Early_infarct_growth)["1st Qu."][[1]],0), ",",
        round(summary(d$Early_infarct_growth)["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Late_infarct_growth)["Median"][[1]],0), "[",
        round(summary(d$Late_infarct_growth)["1st Qu."][[1]],0), ",",
        round(summary(d$Late_infarct_growth)["3rd Qu."][[1]],0), "]"),
  paste(round(summary(d$Total_infarct_growth)["Median"][[1]],0), "[",
        round(summary(d$Total_infarct_growth)["1st Qu."][[1]],0), ",",
        round(summary(d$Total_infarct_growth)["3rd Qu."][[1]],0), "]"))

table2 <- data.frame(table2_col1, table2_col2, table2_col3, table2_col4, table2_col5, table2_col6, table2_col7)
colnames(table2) <- c("", "TICI 0 (n=7)", "TICI 2a (n=7)", "TICI 2b (n=20)", "TICI 2c (n=29)", "TICI 3 (n=35)", "All (n=98)")
```

### Bivariate descriptive analysis

To start with, it is important to mention that the variable TICI grade is used in table 2 because it is a relevant variable from a clinical point of view because it measures the success of the recanalization. 

In order to check if patients in each TICI grade category are comparable at baseline, a non parametric test (Kruskal-Wallis) is made to prove that there are no significant differences in the medians of infarct volume pre EVT and the Tmax6 volume pre among the TICI grade. The resulted p-values are 0.223 and 0.824, for the infarct volume pre EVT and the Tmax6 volume pre, respectively. In both cases, these results lead to the non-rejection region of the null hypothesis. Consequently, there is no evidence of a different distribution according to TICI grade. 

Nevertheless, the last three rows of table 2 show that there is a major difference in infarct growths (mL) for TICI grades less than 2b. Kruskal-Wallis tests resulted significant with p-values equal to 0.001, 0.012, 0.004 for the early, late and total infarct growths, respectively. Patients with TICI grades less than 2b had more severe injuries with higher infarct growth after the procedure.

&nbsp;

```{r eval=FALSE, include=FALSE}
#car::leveneTest(c(d$V_pre_EVT)~d$TICI_equal_higher2B)
round(kruskal.test(d$V_pre_EVT~d$TICI_equal_higher2B)$p.value,3)
round(kruskal.test(d$TMax_6s_pre_EVT~d$TICI_equal_higher2B)$p.value,3)
round(kruskal.test(d$Early_infarct_growth~d$TICI_equal_higher2B)$p.value,3)
round(kruskal.test(d$Late_infarct_growth~d$TICI_equal_higher2B)$p.value,3)
round(kruskal.test(d$Total_infarct_growth~d$TICI_equal_higher2B)$p.value,3)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table2, align= c('l', 'c', 'c','c','c','c','c'), format="latex", caption = "Infarct and hypoperfusion volumes and infarct growths (mL) between the three time points according to TICI grade",
  booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position", "scale_down"),font_size = 10,  full_width=F) %>%
  row_spec(0, bold=T, color= "black") %>%
  row_spec(2, hline_after=T) %>%
  row_spec(5, hline_after = T) %>%
  row_spec(7, hline_after = T) %>%
  footnote(general="Median and [IQR] are provided")
```

Moreover, an explanatory analysis is done, prior to the construction of the models, to see if the explicative variables are related to infarct growths by means of a correlation analysis (Table 3). 

For instance, a significant positive correlation is found between early infarct growth and the number of passes. As well as, late infarct growth and Tmax volume post. This last variable also is positively correlated with total infarct growth. Another significant positive correlation is found between total infarct growth and occlusion post. 

On the contrary, a significant negative correlation is found between all infarct growths and TICI grades greater than or equal to 2b (Table 3).

&nbsp;

```{r message=FALSE, warning=FALSE, include=FALSE}

#########################
# TABLE 3 ~ CORRELATIONS:
#########################

table3_col1 <- c("Age (years)", "Sex (male)","Baseline Glycemia", "Baseline NIHSS", "Infarct volume pre EVT", "TMax6 volume pre", "HIR pre", "Good collaterals", "Time onset to recanalization", "Time image to recanalization", "Number of passes", "Complications", "TICI>=2b", "Occlusion post", "TMax6 volume post", "HIR post")

table3_col2 <- c(
  round(cor.test(d$Early_infarct_growth, d$age, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Early_infarct_growth, d$sexo, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Early_infarct_growth, d$Baseline_glycemia, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Early_infarct_growth, d$Baseline_NIHSS, method = "spearman")$estimate[[1]],3),
  #round(cor.test(d$Early_infarct_growth, d$V_pre_EVT, method = "spearman")$estimate[[1]],3),
  "",
  round(cor.test(d$Early_infarct_growth, d$TMax_6s_pre_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Early_infarct_growth, d$HIR_pre_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Early_infarct_growth, d$Good_collaterals, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Early_infarct_growth, d$onset_recan, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Early_infarct_growth, d$imaging_recan, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Early_infarct_growth, d$num_passes, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Early_infarct_growth, d$complicaciones2, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Early_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$estimate[[1]],3),
  "", "", "")

table3_col3 <- c(
  ifelse(round(cor.test(d$Early_infarct_growth, d$age, method = "spearman")$p.value,3)<0.001,
         "<0.001",round(cor.test(d$Early_infarct_growth, d$age, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Early_infarct_growth, d$sexo, method = "pearson")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Early_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Early_infarct_growth, d$Baseline_glycemia, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Early_infarct_growth, d$Baseline_glycemia, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Early_infarct_growth, d$Baseline_NIHSS, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Early_infarct_growth, d$Baseline_NIHSS, method = "spearman")$p.value,3)),
  # ifelse(round(cor.test(d$Early_infarct_growth, d$V_pre_EVT, method = "spearman")$p.value,3)<0.001,
  #        "<0.001",
  #        round(cor.test(d$Early_infarct_growth, d$V_pre_EVT, method = "spearman")$p.value,3)),
  "",
  ifelse(round(cor.test(d$Early_infarct_growth, d$TMax_6s_pre_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Early_infarct_growth, d$TMax_6s_pre_EVT, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Early_infarct_growth, d$HIR_pre_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Early_infarct_growth, d$HIR_pre_EVT, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Early_infarct_growth, d$Good_collaterals, method = "pearson")$p.value,3)<0.001,
          "<0.001",
          round(cor.test(d$Early_infarct_growth, d$Good_collaterals, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Early_infarct_growth, d$onset_recan, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Early_infarct_growth, d$onset_recan, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Early_infarct_growth, d$imaging_recan, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Early_infarct_growth, d$imaging_recan, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Early_infarct_growth, d$num_passes, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Early_infarct_growth, d$num_passes, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Early_infarct_growth, d$complicaciones2, method = "pearson")$p.value,3)<0.001,
        "<0.001",
        round(cor.test(d$Early_infarct_growth,d$complicaciones2, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Early_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Early_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$p.value,3)),
  "", "", "")

table3_col4 <- c(
  round(cor.test(d$Late_infarct_growth, d$age, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$sexo, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$Baseline_glycemia, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$Baseline_NIHSS, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$V_pre_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$TMax_6s_pre_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$HIR_pre_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$Good_collaterals, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$onset_recan, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$imaging_recan, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$num_passes, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$complicaciones2, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$oclus_post_EVT, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$TMax_6s_post_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Late_infarct_growth, d$HIR_post_EVT, method = "spearman")$estimate[[1]],3))


table3_col5 <- c(
  ifelse(round(cor.test(d$Late_infarct_growth, d$age, method = "spearman")$p.value,3)<0.001,
         "<0.001",round(cor.test(d$Late_infarct_growth, d$age, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$sexo, method = "pearson")$p.value,3)<0.001,
          "<0.001",
          round(cor.test(d$Late_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$Baseline_glycemia, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Late_infarct_growth, d$Baseline_glycemia, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$Baseline_NIHSS, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Late_infarct_growth, d$Baseline_NIHSS, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$V_pre_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Late_infarct_growth, d$V_pre_EVT, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$TMax_6s_pre_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Late_infarct_growth, d$TMax_6s_pre_EVT, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$HIR_pre_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Late_infarct_growth, d$HIR_pre_EVT, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$Good_collaterals, method = "pearson")$p.value,3)<0.001,
       "<0.001",
        round(cor.test(d$Late_infarct_growth, d$Good_collaterals, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$onset_recan, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Late_infarct_growth, d$onset_recan, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$imaging_recan, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Late_infarct_growth, d$imaging_recan, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$num_passes, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Late_infarct_growth, d$num_passes, method = "spearman")$p.value,3)),
   ifelse(round(cor.test(d$Late_infarct_growth, d$complicaciones2, method = "pearson")$p.value,3)<0.001,
          "<0.001",
          round(cor.test(d$Late_infarct_growth,d$complicaciones2, method = "pearson")$p.value,3)),
   ifelse(round(cor.test(d$Late_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$p.value,3)<0.001,
          "<0.001",
          round(cor.test(d$Late_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$p.value,3)),
   ifelse(round(cor.test(d$Late_infarct_growth, d$oclus_post_EVT, method = "pearson")$p.value,3)<0.001,
          "<0.001",
          round(cor.test(d$Late_infarct_growth, d$oclus_post_EVT, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Late_infarct_growth, d$TMax_6s_post_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Late_infarct_growth, d$TMax_6s_post_EVT, method = "spearman")$p.value,3)),
    ifelse(round(cor.test(d$Late_infarct_growth, d$HIR_post_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Late_infarct_growth, d$HIR_post_EVT, method = "spearman")$p.value,3)))

dd <- subset(d, d$TICI_equal_higher2B==1) # database with only tici_fin>=2b

table3_col6 <- c(
  round(cor.test(dd$Late_infarct_growth, dd$age, method = "spearman")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$sexo, method = "pearson")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$Baseline_glycemia, method = "spearman")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$Baseline_NIHSS, method = "spearman")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$V_pre_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$TMax_6s_pre_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$HIR_pre_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$Good_collaterals, method = "pearson")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$onset_recan, method = "spearman")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$imaging_recan, method = "spearman")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$num_passes, method = "spearman")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$complicaciones2, method = "pearson")$estimate[[1]],3),
  "",
  round(cor.test(dd$Late_infarct_growth, dd$oclus_post_EVT, method = "pearson")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$TMax_6s_post_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(dd$Late_infarct_growth, dd$HIR_post_EVT, method = "spearman")$estimate[[1]],3))


table3_col7 <- c(
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$age, method = "spearman")$p.value,3)<0.001,
         "<0.001",round(cor.test(dd$Late_infarct_growth, dd$age, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$sexo, method = "pearson")$p.value,3)<0.001,
          "<0.001",
          round(cor.test(dd$Late_infarct_growth, dd$oclus_post_EVT, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$Baseline_glycemia, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$Baseline_glycemia, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$Baseline_NIHSS, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$Baseline_NIHSS, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$V_pre_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$V_pre_EVT, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$TMax_6s_pre_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$TMax_6s_pre_EVT, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$HIR_pre_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$HIR_pre_EVT, method = "spearman")$p.value,3)),
   ifelse(round(cor.test(dd$Late_infarct_growth, dd$Good_collaterals, method = "pearson")$p.value,3)<0.001,
          "<0.001",
          round(cor.test(dd$Late_infarct_growth, dd$Good_collaterals, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$onset_recan, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$onset_recan, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$imaging_recan, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$imaging_recan, method = "spearman")$p.value,3)),
  
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$num_passes, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$num_passes, method = "spearman")$p.value,3)),
  
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$complicaciones2, method = "pearson")$p.value,3)<0.001,
          "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$complicaciones2, method = "pearson")$p.value,3)),
  "",
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$oclus_post_EVT, method = "pearson")$p.value,3)<0.001,
          "<0.001",
          round(cor.test(dd$Late_infarct_growth, dd$oclus_post_EVT, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$TMax_6s_post_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$TMax_6s_post_EVT, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(dd$Late_infarct_growth, dd$HIR_post_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(dd$Late_infarct_growth, dd$HIR_post_EVT, method = "spearman")$p.value,3)))

table3_col8 <- c(
  round(cor.test(d$Total_infarct_growth, d$age, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$sexo, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$Baseline_glycemia, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$Baseline_NIHSS, method = "spearman")$estimate[[1]],3),
  "",
  round(cor.test(d$Total_infarct_growth, d$TMax_6s_pre_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$HIR_pre_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$Good_collaterals, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$onset_recan, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$imaging_recan, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$num_passes, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$complicaciones2, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$oclus_post_EVT, method = "pearson")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$TMax_6s_post_EVT, method = "spearman")$estimate[[1]],3),
  round(cor.test(d$Total_infarct_growth, d$HIR_post_EVT, method = "spearman")$estimate[[1]],3))

table3_col9 <- c(
  ifelse(round(cor.test(d$Total_infarct_growth, d$age, method = "spearman")$p.value,3)<0.001,
         "<0.001",round(cor.test(d$Total_infarct_growth, d$age, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$sexo, method = "pearson")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$Baseline_glycemia, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$Baseline_glycemia, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$Baseline_NIHSS, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$Baseline_NIHSS, method = "spearman")$p.value,3)),
  "",
  ifelse(round(cor.test(d$Total_infarct_growth, d$TMax_6s_pre_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$TMax_6s_pre_EVT, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$HIR_pre_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$HIR_pre_EVT, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$Good_collaterals, method = "pearson")$p.value,3)<0.001,
          "<0.001",
          round(cor.test(d$Total_infarct_growth, d$Good_collaterals, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$onset_recan, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$onset_recan, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$imaging_recan, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$imaging_recan, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$num_passes, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$num_passes, method = "spearman")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$complicaciones2, method = "pearson")$p.value,3)<0.001,
        "<0.001",
        round(cor.test(d$Total_infarct_growth,d$complicaciones2, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$TICI_equal_higher2B, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$oclus_post_EVT, method = "pearson")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$oclus_post_EVT, method = "pearson")$p.value,3)),
  ifelse(round(cor.test(d$Total_infarct_growth, d$TMax_6s_post_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$TMax_6s_post_EVT, method = "spearman")$p.value,3)),
    ifelse(round(cor.test(d$Total_infarct_growth, d$HIR_post_EVT, method = "spearman")$p.value,3)<0.001,
         "<0.001",
         round(cor.test(d$Total_infarct_growth, d$HIR_post_EVT, method = "spearman")$p.value,3)))

table3 <- data.frame(table3_col1, table3_col2, table3_col3, table3_col4, table3_col5, table3_col6, table3_col7, table3_col8, table3_col9)
colnames(table3) <- c("", "Coefficient", "p", "Coefficient", "p", "Coefficient", "p", "Coefficient", "p" )
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table3,align= c('l', 'c', 'c', 'c', 'c','c','c','c','c'), caption = "Correlation between infarct growths (mL) and relevant variables",
      booktabs = T, linesep="", longtable=T) %>%
  kable_styling(latex_options = c("hold_position", "scale_down", "striped", "repeat_header"), stripe_index = c(1,3,5,7,9,11,13,15), full_width=F, font_size = 8) %>%
  row_spec(0, bold=T, color= "black") %>%
  add_header_above(c("Variable", "Early infarct growth" = 2, "Late infarct growth\n(All the sample)"=2, 
                 "Late infarct growth\n(Only TICI>=2b)"=2, "Total infarct growth"=2), bold=T) %>%
  column_spec(1, width = "2.75cm")
```

Patients with TICI grades less than 2b have a higher median and variability in early infarct growth. For instance, for early infarct growth, the median is almost 42 mL when TICI grade is 0, 55 mL when TICI grade is 2a and not higher than 7 mL for the other greater TICI grades. The same pattern is observed with late and total infarct growths (Figure 7).


```{r include=FALSE}

################################
# FIGURE 6 ~ BOXPLOT TICI GRADE:
################################

boxplot1 <- ggplot(d, aes(x=tici_fin, y=Early_infarct_growth, fill=tici_fin)) + 
  geom_boxplot() + 
  labs(title="", y="Early", x="")+
    scale_fill_brewer(direction=-1) + ylim(-50,400)
boxplot2 <- ggplot(d, aes(x=tici_fin, y=Late_infarct_growth, fill=tici_fin)) + 
  geom_boxplot() + 
  labs(title="", y="Late", x="")+
    scale_fill_brewer(direction=-1) + ylim(-50,400)
boxplot3 <- ggplot(d, aes(x=tici_fin, y=Total_infarct_growth, fill=tici_fin)) + 
  geom_boxplot() + 
  labs(title="", y="Total", x="")+
    scale_fill_brewer(direction=-1) + ylim(-50,400)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.height=3.75, fig.width=7, fig.cap="Distribution of infarct growths at the three time points according to TICI grade"}
require(gridExtra)
grid.arrange(boxplot1 + theme(legend.position = "non2"), boxplot2 + theme(legend.position = "non2"), boxplot3 + theme(legend.position = "non2"), ncol=2)
```

\newpage

The motivation of figure 8 is to assess the contribution of each infarct growth (early and late) to the total infarct growth. This figure shows that for both, early and late infarct growths, the slopes are quite similar between the two groups of TICI grades. However, there is a different intercept; meaning that a patient without differences between the infarct volume pre EVT and post will have a higher late infarct growth if the TICI grade is less than 2b. Alternative representations of figure 8 can be found in the Appendix 1 (Figure 42).

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.height=4.5, fig.width=6, fig.cap="Relationship between the total infarct growth with the early and late infarct growths"}

##################################################
# FIGURE 7 ~ Relationship between infarct growths:
##################################################

d_melted4 <- melt(d[c(1,5,6,62,14)], id.vars=c("ID_FURIAS", "Total_infarct_growth", "TICI_equal_higher2B"))
colnames(d_melted4)[1] <- c("id")

my_blue <- brewer.pal(n = 9, "Blues")[c(6,9)]

ggplot(d_melted4, aes(x=value, y=Total_infarct_growth, group=variable,
                      colour=variable)) +
  scale_colour_manual(values=my_blue, name="", labels=c("Early infarct growth","Late infarct growth")) +
  geom_point()+
  geom_smooth(method=lm)+ 
  labs(title="", x="mL", y="Total infarct growth")+
  scale_fill_brewer(palette="Blues")+
  facet_wrap(.~TICI_equal_higher2B, labeller=labeller(TICI_equal_higher2B = c("0" = "TICI<2b", "1" = "TICI>=2b")))+ theme(legend.position="bottom")
```

In order to know if the slopes, for each TICI grade, in figure 8 can be considered different, a parametric paired t-test is made using the logarithmic transformation. This test proves that there are no significant differences between the slopes stratifying for TICI grades because 1 is not included in either of the two confidence intervals. 

For TICI grades less than 2b, the following 95% CI for the ratio of the slopes is obtained: 

$$ 95\%\;CI_{TICI<2b}=[0.219,1.002]$$

For TICI grades greater than or equal to 2b, the following 95% CI is obtained: 

$$ 95\%\;CI_{TICI\geq2b}=[0.332,2.149]$$

```{r warning=FALSE, comment=F, include=FALSE}
# TICI>=2b
tt <- t.test(log(dd$Late_infarct_growth),log(dd$Early_infarct_growth), paired=T)
exp(tt$conf.int)

model_early <- lm(Total_infarct_growth~Early_infarct_growth, data=dd)
summary(model_early)

model_late <- lm(Total_infarct_growth~Late_infarct_growth, data=dd)
summary(model_late)

# Intercept is not 0
tt2 <- t.test(log((dd$Total_infarct_growth-4.63399)/dd$Late_infarct_growth),log((dd$Total_infarct_growth-12.1496)/dd$Early_infarct_growth), paired=T)
exp(tt2$conf.int)

# TICI<2b
dd2 <- subset(d, d$TICI_equal_higher2B==0) # database with only tici_fin<2b

tt_2 <- t.test(log(dd2$Late_infarct_growth),log(dd2$Early_infarct_growth), paired=T)
exp(tt_2$conf.int)

model_early2 <- lm(Total_infarct_growth~Early_infarct_growth, data=dd2)
summary(model_early2)

model_late2 <- lm(Total_infarct_growth~Late_infarct_growth, data=dd2)
summary(model_late2)

# Intercept is not 0
tt_3 <- t.test(log((dd$Total_infarct_growth-34.296)/dd$Late_infarct_growth),log((dd$Total_infarct_growth-36.9833)/dd$Early_infarct_growth), paired=T)
exp(tt_3$conf.int)
```

```{r include=FALSE}
# Transform numerical variables into categorical:
d$TICI_equal_higher2B <- as.factor(ifelse(d$TICI_equal_higher2B==0, c("TICI<2b"),
                                          c("TICI>=2b")))
d$oclus_post_EVT <- as.factor(ifelse(d$oclus_post_EVT==0, c("No"), c("Yes")))
d$Good_collaterals <- as.factor(ifelse(d$Good_collaterals==0, c("No"), c("Yes")))
d$complicaciones2 <- as.factor(ifelse(d$complicaciones2==0,c("No"), c("Yes")))

# Create logarithms of the infarct volumes:
d$Log_V_pre_EVT <- log(d$V_pre_EVT)
d$Log_V_post_EVT <- log(d$V_post_EVT)
d$Log_V_5d <- log(d$V_5d)
```

\newpage

### Missing data

It is worth to mention that there is missing data on the variables that are used for the models. For this reason, it is interesting to make a descriptive analysis of them (Figure 9). For all models, except for those made using infarct growths, the missing values are imputed.

```{r echo=FALSE, fig.align="center", fig.cap="Missing data patterns", fig.height=5, fig.width=6.25, message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE}

###################################
# FIGURE 8 ~ Missing data patterns:
###################################

dades <- d[c(10, 11, 12, 20, 21, 13, 15, 16, 17, 19, 14, 22, 24, 25, 63, 64, 65)]

# md.pattern(dades, rotate.names = TRUE)

aggr_plot <- aggr(dades, col=c(brewer.pal(9, "Blues")[c(9,6)]), numbers=T, labels=c("Age","Baseline Glycemia", "Baseline NIHSS", "TMax6 volume pre", "HIR pre", "Good collaterals", "Time onset to recan.", "Time image to recan.", "Number of passes", "Complications", "TICI>=2b", "Occlusion post", "TMax6 volume post", "HIR post", "Infarct vol. pre EVT", "Infarct vol. post EVT", "Infarct vol. 5 days"), cex.axis=.5, gap=3, ylab=c("Histogram of missing data","Pattern"))

set.seed(2021)

row1 <- c(rep(1,14),0,0,0)
row2 <- rep(0,17)
m <- matrix(c(rep(row1,14), rep(row2,3)), ncol=17, byrow=T)
diag(m)=0
```

Almost 45% of the patients have complete information. Moreover, almost 22% and 19.4% of the values of infarct volume on day 5 and of the variable _Good collaterals_ are missing. This last variable also has the highest number of missing values among the relevant predictors (Table 4).

Despite this, there are some relevant variables that have complete information, such as infarct volume pre EVT, age, sex and TICI grade, to name a few. 

It is important to mention that the variable that has more missing values is infarct volume on day 5 because some patients died within 5 days after the mechanical thrombectomy. In those cases, one option would have been to assign the worst value of infarct volume to these patients. Nevertheless, the final decision is not to impute the values in the response variables.

```{r include=FALSE}
# Transforming some variables into numeric or categoric as required:
d$Good_collaterals <- ifelse(d$Good_collaterals=="No", c(0), c(1))
d$complicaciones2 <- ifelse(d$complicaciones2=="No", c(0), c(1))
d$num_passes_cat <- as.factor(ifelse(d$num_passes==1, c("One pass"), c("More passes")))
d$sexo <- as.factor(ifelse(d$sexo==1, c("Hombre"), c("Mujer")))

dd$TICI_equal_higher2B <- as.factor(ifelse(dd$TICI_equal_higher2B==0, c("TICI<2b"),
                                          c("TICI>=2b")))
dd$oclus_post_EVT <- as.factor(ifelse(dd$oclus_post_EVT==0, c("No"), c("Yes")))
dd$num_passes_cat <- as.factor(ifelse(dd$num_passes==1, c("One pass"), c("More passes")))


#####################
# TABLE 4 ~ MISSINGS:
#####################

miss_Early <- miss_Late <- miss_Total <- miss_Latet <- miss <- c()

ddd <- d[c(10, 31, 11, 12, 2, 20, 21, 13, 15, 16, 66, 19, 14, 22, 24, 25)] 

dddd <- dd[c(10, 31,11, 12, 2, 20, 21, 13, 15, 16, 63, 18, 22, 24, 25)] 

for (i in 1:13) {
  lmfit <- lm(d$Early_infarct_growth~ddd[,i])
  miss_Early[[i]] <- length(summary(lmfit)$na.action)
}

for (i in 1:ncol(ddd)) {
  lmfit <- lm(d$Late_infarct_growth~ddd[,i])
  miss_Late[[i]] <- length(summary(lmfit)$na.action)
}

for (i in 1:ncol(dddd)) {
  lmfit <- lm(dd$Late_infarct_growth~dddd[,i])
  miss_Latet[[i]] <- length(summary(lmfit)$na.action)
}

for (i in 1:ncol(ddd)) {
  lmfit <- lm(d$Total_infarct_growth~ddd[,i])
  miss_Total[[i]] <- length(summary(lmfit)$na.action)
}

for (i in 1:ncol(ddd)) {
  miss[[i]] <- sum(is.na(ddd[,i]))
}

coef_Latet3 <- round(as.numeric(miss_Latet)/98*100,2)
miss_Latet[c(1,2,3,4,5,6,7,8,9,10,11,12)] <- (paste(miss_Latet[c(1,2,3,4,5,6,7,8,9,10,11,12)], "(", coef_Latet3[c(1,2,3,4,5,6,7,8,9,10,11,12)], "%", ")"))
miss_Latet[c(13,14,15)] <- (paste(miss_Latet[c(13,14,15)], "(", coef_Latet3[c(13,14,15)], "%", ")"))
miss_Latet <- c(paste(miss_Latet[c(1,2,3,4,5,6,7,8,9,10,11,12)]), "", paste(miss_Latet[c(13,14,15)]))


coef_Early3 <- round(as.numeric(miss_Early)/98*100,2)
miss_Early <- (paste(miss_Early, "(", coef_Early3, "%", ")"))

miss_Early <- c(miss_Early[1:4],"", miss_Early[6:13], "", "", "")
coef_Early3 <- c(coef_Early3, "", "", "")

coef_Late3 <- round(as.numeric(miss_Late)/98*100,2)
miss_Late <- (paste(miss_Late, "(", coef_Late3, "%", ")"))

coef_Total3 <- round(as.numeric(miss_Total)/98*100,2)
miss_Total <- (paste(miss_Total, "(", coef_Total3, "%", ")"))
miss_Total <- c(miss_Total[1:4], "", miss_Total[6:16])

miss2 <- round(miss/98*100,2)
miss <- (paste(miss, "(", miss2, "%", ")"))

table4_col1 <- c("Age (years)", "Sex (male)","Baseline Glycemia", "Baseline NIHSS", "Infarct volume pre EVT", "TMax6 volume pre", "HIR pre", "Good collaterals", "Time onset to recanalization", "Time image to recanalization", "Number of passes", "Complications", "TICI>=2b", "Occlusion post",  "TMax6 volume post", "HIR post")

table4 <- data.frame(table4_col1, miss,miss_Early, miss_Late, miss_Latet, miss_Total)
                     
colnames(table4) <- c("", "Missings","Missings", "Missings", "Missings", "Missings")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.height=3.5,}
kable(table4, align= c('l', 'c', 'c','c','c', 'c'), caption = "Number and percentage of missing values by variable (first column) and for each univariate model with infarct growth response", booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"),  stripe_index = c(1,3,5,7,9,11,13,15), full_width=F,font_size = 10) %>%
  row_spec(0, bold=T, color= "black")%>%
add_header_above(c("", "","Early infarct growth"=1, "Late infarct growth\n(All the sample)" = 1, "Late infarct growth\n(Only TICI>=2b)"=1, "Total infarct growth"=1), bold=T)
```

```{r include=FALSE}

################################
# TABLE 5 ~ UNIVARIATE ANALYSIS:
################################

coef_Early <- pval_Early <- intp_Early <- intn_Early <- c()
coef_Late <- pval_Late <- intp_Late <- intn_Late <- c()
coef_Total <- pval_Total <- intp_Total <- intn_Total <-c()
coef_Latet <- pval_Latet <- intp_Latet <- intn_Latet <- c()

for (i in 1:13) {
  lmfit <- lm(d$Early_infarct_growth~ddd[,i])
  coef_Early[[i]] <- summary(lmfit)$coefficients[2,1]
  pval_Early[[i]] <- summary(lmfit)$coefficients[2,4]
  intp_Early[[i]] <- summary(lmfit)$coefficients[2,1]+qt(0.975,summary(lmfit)$df[2])*summary(lmfit)$coefficients[2,2]
  intn_Early[[i]] <- summary(lmfit)$coefficients[2,1]-qt(0.975,summary(lmfit)$df[2])*summary(lmfit)$coefficients[2,2]
}

for (i in 1:ncol(ddd)) {
  lmfit <- lm(d$Late_infarct_growth~ddd[,i])
  coef_Late[[i]] <- summary(lmfit)$coefficients[2,1]
  pval_Late[[i]] <- summary(lmfit)$coefficients[2,4]
  intp_Late[[i]] <- coef_Late[[i]]+qt(0.975,summary(lmfit)$df[2])*summary(lmfit)$coefficients[2,2]
  intn_Late[[i]] <- coef_Late[[i]]-qt(0.975,summary(lmfit)$df[2])*summary(lmfit)$coefficients[2,2]
}

for (i in 1:ncol(dddd)) {
  lmfit <- lm(dd$Late_infarct_growth~dddd[,i])
  coef_Latet[[i]] <- summary(lmfit)$coefficients[2,1]
  pval_Latet[[i]] <- summary(lmfit)$coefficients[2,4]
  intp_Latet[[i]] <- coef_Latet[[i]]+qt(0.975,summary(lmfit)$df[2])*summary(lmfit)$coefficients[2,2]
  intn_Latet[[i]] <- coef_Latet[[i]]-qt(0.975,summary(lmfit)$df[2])*summary(lmfit)$coefficients[2,2]
}

for (i in 1:ncol(ddd)) {
  lmfit <- lm(d$Total_infarct_growth~ddd[,i])
  coef_Total[[i]] <- summary(lmfit)$coefficients[2,1]
  pval_Total[[i]] <- summary(lmfit)$coefficients[2,4]
  intp_Total[[i]] <- coef_Total[[i]]+qt(0.975,summary(lmfit)$df[2])*summary(lmfit)$coefficients[2,2]
  intn_Total[[i]] <- coef_Total[[i]]-qt(0.975,summary(lmfit)$df[2])*summary(lmfit)$coefficients[2,2]
}

coef_Early <- paste(round(coef_Early,2), "[", round(intn_Early,2), ",", round(intp_Early,2), "]")
coef_Early <- c(coef_Early[1:4], "", coef_Early[6:13], "", "", "")

pval_Early <- ifelse(round(pval_Early,3)<0.001, "<0.001", round(pval_Early,3))
pval_Early <- c(pval_Early[1:4],"", pval_Early[6:13], "", "", "")

coef_Latet <- c(paste(round(coef_Latet[c(1,2,3,4,5,6,7,8,9,10,11,12)],2), "[", round(intn_Latet[c(1,2,3,4,5,6,7,8,9,10,11,12)],2),
                      ",", round(intp_Latet[c(1,2,3,4,5,6,7,8,9,10,11,12)],2), "]"), "",
                paste(round(coef_Latet[c(13,14,15)],2), "[", round(intn_Latet[c(13,14,15)],2),
                      ",", round(intp_Latet[c(13,14,15)],2), "]"))

pval_Latet <- ifelse(round(pval_Latet,3)<0.001, "<0.001", round(pval_Latet,3))
pval_Latet <- c(paste(pval_Latet[c(1,2,3,4,5,6,7,8,9,10,11,12)]), "", paste(pval_Latet[c(13,14,15)]))

coef_Total <- paste(round(coef_Total,2), "[", round(intn_Total,2), ",", round(intp_Total,2), "]")
coef_Total <- c(coef_Total[1:4], "", coef_Total[6:16])

pval_Total <- ifelse(round(pval_Total,3)<0.001, "<0.001", round(pval_Total,3))
pval_Total <- c(pval_Total[1:4],"", pval_Total[6:16])

table5 <- data.frame(table4_col1, coef_Early, pval_Early,
                     paste(round(coef_Late,2), "[", round(intn_Late,2), ",",
                           round(intp_Late,2), "]"),
                     ifelse(round(pval_Late,3)<0.001, "<0.001", round(pval_Late,3)),
                     coef_Latet, pval_Latet, coef_Total, pval_Total)

colnames(table5) <- c("", "Coefficient", "p", "Coefficient", "p", "Coefficient", "p", "Coefficient", "p")
```

\newpage
\mbox{~}

## General linear models

### Univariate models

To start with, a univariate analysis is done to detect which are the predictors that are statistically relevant.

In table 5, one can see that in the early infarct growth the values of Occlusion post, TMax6 volume post and HIR post, are not included in the univariate analysis because variables post-procedure cannot be taken into account. Moreover, the variable infarct volume pre EVT it is also not included in the early and total infarct growths because the endogenous variable of these models is calculated based on this variable.

The variable TICI grade resulted significant in all the univariate models because its p-value is lower than the fixed 5% significance level, meaning that the pertinent coefficient is statistically different from zero, indicating that it is a relevant variable.

Also, time image to recanalization has a significant parameter in early and total infarct growth models because the resulted p-values are lower than the fixed 5% significance level. However, for late infarct growth, the resulted p-value is 0.066, which is slightly higher than the significance level but very close to it. Given the above, this variable is considered relevant for these three models.

\newpage

```{r echo=FALSE}
kable(table5, align= c('l', 'c', 'c','c','c','c','c', 'c', 'c'), caption = "Univariate analysis for early, late and total infarct growth", booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"),  stripe_index = c(1,3,5,7,9,11,13,15), full_width=F,font_size = 10) %>%
  row_spec(0, bold=T, color= "black")%>%
add_header_above(c("", "Early infarct growth"=2, "Late infarct growth\n(All the sample)" = 2, "Late infarct growth\n(Only TICI>=2b)"=2, "Total infarct growth"=2), bold=T)%>%
column_spec(1, width = "2.75cm")
```

```{r eval=FALSE, include=FALSE}
########
# EARLY:
########

summ(lm(Early_infarct_growth~(HIR_pre_EVT+imaging_recan+num_passes_cat)*TICI_equal_higher2B, data=d))

anova(lm(Early_infarct_growth~HIR_pre_EVT+imaging_recan+num_passes_cat+TICI_equal_higher2B+num_passes_cat:TICI_equal_higher2B, data=d),
      lm(Early_infarct_growth~(HIR_pre_EVT+imaging_recan+num_passes_cat)*TICI_equal_higher2B, data=d),
      test="F")

summ(lm(Early_infarct_growth~HIR_pre_EVT+imaging_recan+num_passes_cat+TICI_equal_higher2B+num_passes_cat:TICI_equal_higher2B, data=d))

anova(lm(Early_infarct_growth~HIR_pre_EVT+imaging_recan+num_passes_cat+TICI_equal_higher2B, data=d),
      lm(Early_infarct_growth~HIR_pre_EVT+imaging_recan+num_passes_cat+TICI_equal_higher2B+num_passes_cat:TICI_equal_higher2B, data=d),
      test="F")

dades_early<-d[is.na(d$imaging_recan)==F  ,]

summary(lm(Early_infarct_growth~HIR_pre_EVT+num_passes_cat+TICI_equal_higher2B+num_passes_cat:TICI_equal_higher2B, data=dades_early))
summary(lm(Early_infarct_growth~HIR_pre_EVT+imaging_recan+num_passes_cat+TICI_equal_higher2B+num_passes_cat:TICI_equal_higher2B, data=dades_early))

anova(lm(Early_infarct_growth~HIR_pre_EVT+num_passes_cat+TICI_equal_higher2B+num_passes_cat:TICI_equal_higher2B, data=dades_early),
      lm(Early_infarct_growth~HIR_pre_EVT+imaging_recan+num_passes_cat+TICI_equal_higher2B+num_passes_cat:TICI_equal_higher2B, data=dades_early),
      test="F")

summ(lm(Early_infarct_growth~HIR_pre_EVT+num_passes_cat+TICI_equal_higher2B+num_passes_cat:TICI_equal_higher2B, data=d), confint=T)

#######
# LATE:
#######

summ(lm(Late_infarct_growth~(imaging_recan+oclus_post_EVT+TMax_6s_post_EVT+V_pre_EVT)*TICI_equal_higher2B, data=d))

summ(lm(Late_infarct_growth~(imaging_recan+oclus_post_EVT+TMax_6s_post_EVT)*TICI_equal_higher2B, data=d))

anova(lm(Late_infarct_growth~imaging_recan+imaging_recan:TICI_equal_higher2B+
           oclus_post_EVT+TMax_6s_post_EVT+TMax_6s_post_EVT:TICI_equal_higher2B+
           TICI_equal_higher2B, data=d),
      lm(Late_infarct_growth~(imaging_recan+oclus_post_EVT+TMax_6s_post_EVT)*TICI_equal_higher2B,
         data=d),
      test="F")

summ(lm(Late_infarct_growth~imaging_recan+imaging_recan:TICI_equal_higher2B+
           oclus_post_EVT+TMax_6s_post_EVT+TMax_6s_post_EVT:TICI_equal_higher2B+
           TICI_equal_higher2B, data=d))

anova(lm(Late_infarct_growth~imaging_recan+imaging_recan:TICI_equal_higher2B+
           TMax_6s_post_EVT+TMax_6s_post_EVT:TICI_equal_higher2B+
           TICI_equal_higher2B, data=d),
      lm(Late_infarct_growth~imaging_recan+imaging_recan:TICI_equal_higher2B+
           oclus_post_EVT+TMax_6s_post_EVT+TMax_6s_post_EVT:TICI_equal_higher2B+
           TICI_equal_higher2B, data=d),
      test="F")

summ(lm(Late_infarct_growth~imaging_recan+imaging_recan:TICI_equal_higher2B+
           TMax_6s_post_EVT+TMax_6s_post_EVT:TICI_equal_higher2B+
           TICI_equal_higher2B, data=d), confint=T)

########
# TOTAL:
########

summ(lm(Total_infarct_growth~(imaging_recan+num_passes_cat+oclus_post_EVT+
                                  TMax_6s_post_EVT)*TICI_equal_higher2B, data=d))

anova(lm(Total_infarct_growth~imaging_recan+num_passes_cat+oclus_post_EVT+
           TMax_6s_post_EVT+TICI_equal_higher2B+
           TMax_6s_post_EVT:TICI_equal_higher2B+
           imaging_recan:TICI_equal_higher2B, data=d),
       lm(Total_infarct_growth~(imaging_recan+num_passes_cat+oclus_post_EVT+
                                  TMax_6s_post_EVT)*TICI_equal_higher2B, data=d),test="F")

summ(lm(Total_infarct_growth~imaging_recan+num_passes_cat+oclus_post_EVT+
           TMax_6s_post_EVT+TICI_equal_higher2B+
           TMax_6s_post_EVT:TICI_equal_higher2B+
           imaging_recan:TICI_equal_higher2B, data=d))

anova(lm(Total_infarct_growth~imaging_recan+num_passes_cat+
           TMax_6s_post_EVT+TICI_equal_higher2B+
           TMax_6s_post_EVT:TICI_equal_higher2B+
           imaging_recan:TICI_equal_higher2B, data=d),
      lm(Total_infarct_growth~imaging_recan+num_passes_cat+oclus_post_EVT+
           TMax_6s_post_EVT+TICI_equal_higher2B+
           TMax_6s_post_EVT:TICI_equal_higher2B+
           imaging_recan:TICI_equal_higher2B, data=d),
      test="F")

dades_total <- d[is.na(d$num_passes_cat)==F,]

anova(lm(Total_infarct_growth~imaging_recan+
           TMax_6s_post_EVT+TICI_equal_higher2B+
           TMax_6s_post_EVT:TICI_equal_higher2B+
           imaging_recan:TICI_equal_higher2B, data=dades_total),
      lm(Total_infarct_growth~imaging_recan+num_passes_cat+
           TMax_6s_post_EVT+TICI_equal_higher2B+
           TMax_6s_post_EVT:TICI_equal_higher2B+
           imaging_recan:TICI_equal_higher2B, data=dades_total),
      test="F")

summ(lm(Total_infarct_growth~imaging_recan+
           TMax_6s_post_EVT+TICI_equal_higher2B+
           TMax_6s_post_EVT:TICI_equal_higher2B+
           imaging_recan:TICI_equal_higher2B, data=d), confint=T)
```

```{r message=FALSE, warning=FALSE, include=FALSE}

#######################################
# REGRESSION MODELs EARLY, LATE, TOTAL:
#######################################

d$TICI_equal_higher2B <- ifelse(d$TICI_equal_higher2B=="TICI<2b", c(0), c(1))

Mod_E_num <- lm(Early_infarct_growth~HIR_pre_EVT+num_passes+TICI_equal_higher2B+num_passes:TICI_equal_higher2B, data=d)

Mod_L_num <- lm(Late_infarct_growth~imaging_recan+imaging_recan:TICI_equal_higher2B+
           TMax_6s_post_EVT+TMax_6s_post_EVT:TICI_equal_higher2B+
           TICI_equal_higher2B, data=d)
Mod_T_num <- lm(Total_infarct_growth~imaging_recan+
           TMax_6s_post_EVT+TICI_equal_higher2B+
           TMax_6s_post_EVT:TICI_equal_higher2B+
           imaging_recan:TICI_equal_higher2B, data=d)

d$TICI_equal_higher2B <- as.factor(ifelse(d$TICI_equal_higher2B==0, c("TICI<2b"),
                                          c("TICI>=2b")))

Mod_Et <- lm(Early_infarct_growth~HIR_pre_EVT+num_passes_cat+TICI_equal_higher2B+
              num_passes_cat:TICI_equal_higher2B, data=d)
Mod_Lt <- lm(Late_infarct_growth~imaging_recan+imaging_recan:TICI_equal_higher2B+
              TMax_6s_post_EVT+TMax_6s_post_EVT:TICI_equal_higher2B+
              TICI_equal_higher2B, data=d)
Mod_Tt <- lm(Total_infarct_growth~imaging_recan+
           TMax_6s_post_EVT+TICI_equal_higher2B+
           TMax_6s_post_EVT:TICI_equal_higher2B+
           imaging_recan:TICI_equal_higher2B, data=d)

Mod_E1 <- lm(Early_infarct_growth~HIR_pre_EVT+num_passes_cat+TICI_equal_higher2B, data=d)
Mod_L1 <- lm(Late_infarct_growth~imaging_recan+TMax_6s_post_EVT+
               TICI_equal_higher2B, data=d)
Mod_T1 <- lm(Total_infarct_growth~imaging_recan+
               TMax_6s_post_EVT+TICI_equal_higher2B, data=d)
```

### Multivariate models with infarct growths

As mentioned in the methodology section, the variables that are statistically relevant in the univariate analysis are candidates to enter in the multivariate models. Each of these variables and their interactions with the TICI grade are tested using the F test, which provided the final models. 

Table 6 shows the estimations and the 95% CI of the parameters of each variable. More detailed information of each of these models is included in the Appendix 2.

```{r include=FALSE}

########################################
# TABLE 6 ~ MODELS WITH INFARCT GROWTHS:
########################################

table6_col1 <- c("HIR pre", "Time image to recanalization", "Number of passes",
                 "TMax6 volume post", "TICI>=2B", "Time image to recanalization:TICI>=2B",
                 "TMax6 volume post:TICI>=2B", "Number of passes:TICI>=2B")
table6_col2 <- c("54.75 [13.36, 96.14]", "", "-77.93 [-139.27, -16.59]", "", "-70.64 [-98.88, -42.39]", "", "", "76.15 [11.56, 140.74]")
table6_col3 <- c("", "-1.59 [-2.44, -0.73]","", "0.23 [-0.27, 0.74]",
           "-338.23 [-500.74, -175.73]", "1.70 [0.80, 2.60]", "1.05 [0.42, 1.68]", "")
table6_col4 <- c("", "-1.90 [-2.73, -1.07]", "", 
           "0.08 [-0.41, 0.57]", "-460.3 [-617.48, -303.12]", "2 [1.13, 2.87]",
           "1.39 [0.78, 1.99]", "")

table6 <- data.frame(table6_col1, table6_col2, table6_col3, table6_col4)
                     
colnames(table6)<- c("", "Early infarct growth", "Late infarct growth", "Total infarct growth")
```

```{r echo=FALSE}
kable(table6, align= c('l', 'c', 'c', 'c'), caption = "Coefficient point estimates and 95\\% CI of the multivariate general linear models using infarct growths", booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"),  stripe_index = c(1,3,5,7), full_width=F,font_size = 10) %>%
  row_spec(0, bold=T, color= "black")
```

First, for the early infarct growth model, the R-squared obtained is 0.33; this indicator measures the proportion of the total variability of the endogenous variable explained by the model. Besides, 21 observations are deleted because missing values are found. This model has the following relevant variables: HIR pre and the interaction between the number of passes with the TICI grade. There is no problem of multicollinearity in this model because all the VIFS are lower than 3; the highest VIF found is 1.06, which is from the variable number of passes.

Second, for the late infarct growth model, the R-squared obtained is 0.57. Again, 35 observations are deleted because missing values are found. This model has the following relevant variables: the interactions between time image recanalization and TMax6 volume post, both with the TICI grade. There is no problem of multicollinearity in this model because the highest VIF found is 2.11, which is from the variable TICI grade.

Last, for the total infarct growth model the R-squared obtained is 0.70. Besides, 35 observations are deleted because missing values are found. This model has the same relevant variables than the previous model (the late infarct growth model) and has also no problem of multicollinearity.

```{r eval=FALSE, fig.align="center", fig.cap="", message=FALSE, warning=FALSE, comment=NA, include=FALSE, tinytex.verbose=TRUE}
CLD(emmeans(Mod_Et,~HIR_pre_EVT, at=list(HIR_pre_EVT=c(min(d$HIR_pre_EVT, na.rm=T), median(d$HIR_pre_EVT, na.rm=T), max(d$HIR_pre_EVT, na.rm=T)))), Letters=letters, reversed=T)
```

```{r eval=FALSE, fig.align="center", fig.cap="", message=FALSE, warning=FALSE, comment=NA, include=FALSE, tinytex.verbose=TRUE}
CLD(emmeans(Mod_Et,~num_passes_cat|TICI_equal_higher2B), Letters=letters, reversed=T)
```

```{r eval=FALSE, fig.align="center", fig.cap="", message=FALSE, warning=FALSE, comment=NA, include=FALSE, tinytex.verbose=TRUE}
CLD(emmeans(Mod_Lt,~imaging_recan|TICI_equal_higher2B, at=list(imaging_recan=c(min(d$imaging_recan, na.rm=T), median(d$imaging_recan, na.rm=T), max(d$imaging_recan, na.rm=T)))), Letters=letters, reversed=T)
```

```{r eval=FALSE, fig.align="center", fig.cap="", message=FALSE, warning=FALSE, comment=NA, include=FALSE, tinytex.verbose=TRUE}
CLD(emmeans(Mod_Lt,~TMax_6s_post_EVT|TICI_equal_higher2B, at=list(TMax_6s_post_EVT=c(min(d$TMax_6s_post_EVT, na.rm=T), median(d$TMax_6s_post_EVT, na.rm=T), max(d$TMax_6s_post_EVT, na.rm=T)))), Letters=letters, reversed=T)
```

```{r eval=FALSE, fig.align="center", fig.cap="", message=FALSE, warning=FALSE, comment=NA, include=FALSE, tinytex.verbose=TRUE}
CLD(emmeans(Mod_Tt,~imaging_recan|TICI_equal_higher2B, at=list(imaging_recan=c(min(d$imaging_recan, na.rm=T), median(d$imaging_recan, na.rm=T), max(d$imaging_recan, na.rm=T)))), Letters=letters, reversed=T)
```

```{r eval=FALSE, fig.align="center", fig.cap="", message=FALSE, warning=FALSE, comment=NA, include=FALSE, tinytex.verbose=TRUE}
CLD(emmeans(Mod_Tt,~TMax_6s_post_EVT|TICI_equal_higher2B, at=list(TMax_6s_post_EVT=c(min(d$TMax_6s_post_EVT, na.rm=T), median(d$TMax_6s_post_EVT, na.rm=T), max(d$TMax_6s_post_EVT, na.rm=T)))), Letters=letters, reversed=T)
```

```{r include=FALSE}

####################################################
# TABLE 7 ~ EFFECTS OF MODELS USING INFARCT GROWTHS:
####################################################

table7_col1 <- c("HIR pre", "","", "Number of passes", "","", "","Time image to rec.", "","","","","","TMax6 post","","","", "", "")

table7_col2 <- c("0.855", "0.375", "0.01","More passes", "One pass", "More passes", "One pass", "245", "102", "45","245", "102", "45", "207", "3", "0.01", "207", "3", "0.01")

table7_col9 <- c("", "", "","TICI<2b", "", "TICI>=2b", "", "TICI<2b", "", "", "TICI>=2b", "", "","TICI<2b", "", "", "TICI>=2b", "", "")

table7_col3 <- c("49.63 [25.1, 74.1]", "23.37 [7.2, 39.5]", "3.39 [-19.7, 26.5]","80.28 [55.24, 105.3]", "2.34 [-53.65, 58.3]", "9.64 [-3.45, 22.7]", "7.86 [-7.22, 22.9]","", "","","", "", "","", "","","", "", "")

table7_col4 <- c("a", "b", "c","a", "b", "a", "a","", "","","", "", "","", "","","", "", "")

table7_col5 <- c("", "", "", "","", "", "", "-56.2 [-140.46, 28.1]", "170.9 [89.18, 252.6]", "261.4 [139.41, 383.4]", "48.9 [10.48, 87.3]", "32.7 [20.96, 44.4]", "26.2 [5.38, 47]","193.58 [110.83, 276.3]", "146.16 [65.28, 227]","145.46 [63.63, 227.3]","266.73 [194.45, 339]", "5.56 [-6.22, 17.3]", "1.73 [-10.5, 14]")

table7_col6 <- c("", "","","","", "", "", "a", "b", "c", "a", "a", "a","a", "a","a","a", "b", "c")

table7_col7 <- c("", "", "","", "", "", "", "-10.1 [-91.6, 71.4]", "261.8 [182.7, 340.8]", "370.1 [252.1, 488.1]", "54.5 [17.3, 91.6]", "40.4 [29.1, 51.8]", "34.8 [14.7, 55]", "253.42 [173.38, 333.5]", "236.49 [158.26, 314.7]", "236.24 [157.1, 315.4]", "308.65 [238.74, 378.6]", "8.91 [-2.48, 20.3]", "4.52 [-7.31, 16.3]")

table7_col8 <- c("", "", "","","","", "", "a", "b","c", "a","a", "a","a", "a","a","a", "b", "c")

table7 <- data.frame(table7_col1, table7_col2, table7_col9, table7_col3, table7_col4, table7_col5, table7_col6, table7_col7, table7_col8)
colnames(table7) <- c("", "","", "Estimate", "Group", "Estimate", "Group", "Estimate", "Group")
```

Furthermore, an interpretation and graphical representation of all the effects of each regression model using infarct growths is made in table 7 and figure 10. 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table7, align= c('l', 'c', 'c', 'c', 'c','c','c','c','c'), caption = "Early, late and total infarct growths predictions",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position", "scale_down", "striped"), stripe_index = c(1:3,8:13), full_width=F, font_size = 10) %>%
  row_spec(0, bold=T, color= "black") %>%
  add_header_above(c("Variable","Value", "TICI","Early infarct growth" = 2, "Late infarct growth"=2,
 "Total infarct growth"=2), bold=T) 
# %>%column_spec(1, width = "2.75cm")
```
&nbsp;

For the early infarct growth model, that the variable HIR pre has significant differences between the minimum, the median and the maximum. Higher values of HIR pre are associated with higher values of early infarct growth (Table 7). 

Moreover, the variable number of passes has significant differences between doing one or more passes if TICI grades are less than 2b; more passes involve higher values of early infarct growth.

For the regression models of late and total infarct growths, the variable time image to recanalization has significant differences between the minimum, the median and the maximum when TICI grades are less than 2b. Consequently, higher values of time image to recanalization come with lower values of late and total infarct growths when TICI grades are less than 2b.

\newpage

The variable TMax6 post has significant differences between the minimum, the median and the maximum when TICI grades are greater than or equal to 2b. Higher values of TMax6 post show association with higher values of late and total infarct growths when TICI grades are greater than or equal to 2b.

In addition, a graphical representation of all the associations in the regression models using infarct growths is done in figure 10. It is important to mention, again, that there are only 14 patients that have a non successful recanalization, which means that have TICI grades less than 2b.

&nbsp;

```{r echo=FALSE, fig.cap="", fig.height=3, fig.width=6, message=FALSE, warning=FALSE, comment=F}
eff1.early <- effect_plot(Mod_E_num, pred = HIR_pre_EVT, interval = TRUE, plot.points = TRUE, x.label="HIR pre EVT", y.label="Early", colors=brewer.pal(9, "Blues")[c(9)], point.color=brewer.pal(9, "Blues")[c(9)])

eff3.early <- cat_plot(Mod_Et, pred = num_passes_cat, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Number of passes", y.label="Early", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff2.late <- interact_plot(Mod_Lt, pred = imaging_recan, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Time image to recanalization (minutes)", y.label="Late", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff3.late <- interact_plot(Mod_Lt, pred = TMax_6s_post_EVT, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T,x.label="Volume TMax 6s post EVT", y.label="Late", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff3.total <- interact_plot(Mod_Tt, pred = TMax_6s_post_EVT, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Volume TMax 6s post EVT", y.label="Total", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff4.total <- interact_plot(Mod_Tt, pred = imaging_recan, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Time image to recanalization (minutes)", y.label="Total", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)], legend.position="none")
```

```{r echo=FALSE, fig.align="center", fig.height=6.5,fig.width=7, message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Association plots for the early, late and total infarct growth models", result='asis'}

##########################################
# FIGURE 10 ~ Effect plots -> LATE, TOTAL:
##########################################

legend_b <- get_legend(eff2.late)

grid.arrange(eff1.early + theme(legend.position = "non2"), eff3.early+ theme(legend.position = "non2"),eff2.late+ theme(legend.position = "non2"), eff3.late+ theme(legend.position = "non2"), eff4.total+ theme(legend.position = "non2"), eff3.total+ theme(legend.position = "non2"), legend_b, ncol=2)
```

\newpage

The validation of each regression model using infarct growths is made below.

First, to validate the early infarct growth model, the graphic of residuals versus fitted values serves to assess heteroscedasticity. In this particular case, as shown in figure 11, there seems to be a slightly heteroscedastic pattern. Besides, there is a particular a curvilinear pattern, which indicates that the model may be missing a higher order term to fix the nonlinearity. However, if an older term of HIR pre is applied, the curvilinear pattern is not corrected. For this reason, this older term is not applied. 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=3,  tinytex.verbose=TRUE, comment=NA, fig.cap="Residuals vs fitted values of early infarct growth model", result='asis'}
residualPlot(Mod_Et)
```

Figure 12 shows the Cook's distance, which is a measure to detect observations that have a real influence on the fit, the studentized residuals, which are a measure to detect outliers and the hat-values, whose aim is to highlight a priori influential observations. Observation 31 has the highest Cook's distance and studentized residuals in this model and observations 25 and 49 have the highest hat-values. 

An outlier test is done to show if some of these observations should be considered outliers. Observation 31 should be considered an outlier because the resulted Bonferroni p-value is lower than the fixed 5% significance level (Table 8).

```{r eval=FALSE, include=FALSE}
outlierTest(Mod_Et)
```

```{r include=FALSE}
table8 <- t(data.frame(c("6.634907", "5.447e-09", "4.1942e-07")))
rownames(table8) <- c("31")
colnames(table8) <- c("Rstudent", "Unadjusted p-value","Bonferroni p")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table8, align= c('c', 'c','c'), caption = "Outlier test for the early infarct growth model",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 8) %>%
  row_spec(0, bold=T, color= "black")
```

It is important to mention that this patient (observation 31) had no lesion at all (0 mL) when she arrived at the hospital. Nonetheless, the cerebral artery rapidly infarcted right after, creating an abnormally higher early infarct growth.

\newpage

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=5,  tinytex.verbose=TRUE, comment=NA, fig.cap="Diagnostic plots for early infarct growth model"}
influenceIndexPlot(Mod_Et,vars=c("Cook", "Student","hat"), id=list(n=5))
```

Second, for the late infarct growth model, as shown in figure 13, there seems to be a slightly heteroscedastic pattern. Besides, there is a particular a curvilinear pattern, which indicates that there seems to be nonlinearity. However, no variable in this model has a significant parameter that indicates adding a higher order term in order to fix that. 

Figure 14 shows that observations 10 and 87 have the highest Cook’s distance and studentized residuals in this model. For this reason, outlier tests are done to show if these observations should be considered outliers. The resulted Bonferroni p-values are lower than the fixed 5% significance level. This means, that observation 10 and 87 should be considered outliers (Table 9).

```{r eval=FALSE, include=FALSE}
outlierTest(Mod_Lt)
```

```{r include=FALSE}
table9_col1 <- c("11.527795", "-3.827615")
table9_col2 <- c("2.0633e-16", "3.2846e-04")
table9_col3 <- c("1.2999e-14", "2.0693e-02")
table9 <- data.frame(table9_col1, table9_col2, table9_col3)
rownames(table9) <- c("10", "87")
colnames(table9) <- c("Rstudent", "Unadjusted p-value","Bonferroni p")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table9, align= c('c', 'c','c'), caption = "Outlier test for the late infarct growth model",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 8) %>%
  row_spec(0, bold=T, color= "black")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=2.75,  tinytex.verbose=TRUE, comment=NA, fig.cap="Residuals vs fitted values for late infarct growth", result='asis'}
residualPlot(Mod_Lt)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=4.75,  tinytex.verbose=TRUE, comment=NA, fig.cap="Diagnostic plots for late infarct growth"}
influenceIndexPlot(Mod_Lt,vars=c("Cook", "Student","hat"), id=list(n=5))
```

\newpage

Last, to validate the total infarct growth model, there is a graphical tool that shows if there is heteroscedasticity. In this case, the residuals have no obvious patterns or systematic structure, which means that linearity might be assumed. Despite that, it seems there is a slightly heteroscedastic pattern (Figure 15).

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=3,  tinytex.verbose=TRUE, comment=NA, fig.cap="Residuals vs fitted values for total infarct growth", result='asis'}
residualPlot(Mod_Tt, tests=F)
```

There is an outlier (extreme Y value) which may be underlying a special cause. Figure 16 and table 10 shows that observations 10 and 87 have the highest Cook’s distance and studentized residuals in this model. For this reason, outlier tests are done to show if these observations should be considered outliers. The resulted Bonferroni p-values are lower than the fixed 5% significance level. This means, that observation 10 and 87 should be considered outliers (Table 10).

```{r eval=FALSE, include=FALSE}
outlierTest(Mod_Tt)
```

```{r include=FALSE}
table10_col1 <- c("11.479285", "-3.998065")
table10_col2 <- c("2.4387e-16", "1.8882e-04")
table10_col3 <- c("1.5364e-14", "1.1896e-02")
table10 <- data.frame(table10_col1, table10_col2, table10_col3)
rownames(table10) <- c("10", "87")
colnames(table10) <- c("Rstudent", "Unadjusted p-value","Bonferroni p")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table10, align= c('c', 'c','c'), caption = "Outlier test for the total infarct growth model",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 8) %>%
  row_spec(0, bold=T, color= "black")
```

\newpage

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=4.75,  tinytex.verbose=TRUE, comment=NA, fig.cap="Diagnostic plots for the total infarct growth"}
influenceIndexPlot(Mod_Tt,vars=c("Cook", "Student","hat"), id=list(n=5))
```

To sum up, the forest plots, which draw the association between factors and each infarct growth, of the early, late and total models are shown in figures 17, 18 and 19.

```{r include=FALSE}
# EARLY
res1.e<-confint(glht(Mod_Et, linfct=t(c(0,1,0,0,0)))) 
res2.e<-confint(glht(Mod_Et, linfct=t(c(0,0,1,0,0)))) 
res3.e<-confint(glht(Mod_Et, linfct=t(c(0,0,1,0,1))))

# LATE
res1.l<-confint(glht(Mod_Lt, linfct=t(c(0,1,0,0,0,0))))
res2.l<-confint(glht(Mod_Lt, linfct=t(c(0,1,0,0,1,0))))
res3.l<-confint(glht(Mod_Lt, linfct=t(c(0,0,1,0,0,0))))
res4.l<-confint(glht(Mod_Lt, linfct=t(c(0,0,1,0,0,1))))

#TOTAL
res1.t<-confint(glht(Mod_Tt, linfct=t(c(0,1,0,0,0,0))))
res2.t<-confint(glht(Mod_Tt, linfct=t(c(0,1,0,0,1,0))))
res3.t<-confint(glht(Mod_Tt, linfct=t(c(0,0,1,0,0,0))))
res4.t<-confint(glht(Mod_Tt, linfct=t(c(0,0,1,0,0,1))))
```

```{r include=FALSE}
table_resum1_col1 <- c(as.numeric(res1.e$confint[1]),
              as.numeric(res2.e$confint[1]),
              as.numeric(res3.e$confint[1]))

table_resum1_col2 <- c(as.numeric(res1.e$confint[2]),
              as.numeric(res2.e$confint[2]),
              as.numeric(res3.e$confint[2]))

table_resum1_col3 <- c(as.numeric(res1.e$confint[3]),
              as.numeric(res2.e$confint[3]),
              as.numeric(res3.e$confint[3]))

table_resum1_col4 <- c("HIR pre", "Number of passes:TICI<2b", "Number of passes:TICI>=2b")

table_resum1 <- data.frame(table_resum1_col4,table_resum1_col1,table_resum1_col2,table_resum1_col3)
colnames(table_resum1) <- c("Variable","Mean", "Lower", "Upper")
```

```{r echo=FALSE, fig.align="center",fig.height=2.5, fig.pos='H', message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Forest plot of early infarct growth"}
par(font=1, cex=0.75)
forest(x=table_resum1$Mean,
       ci.lb=table_resum1$Lower,
       ci.ub=table_resum1$Upper,
       slab=table_resum1$Variable,
       pzise=0.75, refline=0, cex=1, efac=0.75, xlab="Additive increase in early infarct growth",
       header=c("Early infarct growth model", "Estimate [95% CI]"))
```

```{r include=FALSE}
table_resum2_col1 <- c(as.numeric(res1.l$confint[1]),
              as.numeric(res2.l$confint[1]),
              as.numeric(res3.l$confint[1]),
              as.numeric(res4.l$confint[1]))

table_resum2_col2 <- c(as.numeric(res1.l$confint[2]),
              as.numeric(res2.l$confint[2]),
              as.numeric(res3.l$confint[2]),
              as.numeric(res4.l$confint[2]))

table_resum2_col3 <- c(as.numeric(res1.l$confint[3]),
              as.numeric(res2.l$confint[3]),
              as.numeric(res3.l$confint[3]),
              as.numeric(res4.l$confint[3]))

table_resum2_col4 <- c("Time to recanalizaton:TICI<2b", "Time to recanalization:TICI>=2b", "TMax6 vol post:TICI<2b", "TMax6 vol post:TICI>=2b")

table_resum2 <- data.frame(table_resum2_col4,table_resum2_col1,table_resum2_col2,table_resum2_col3)
colnames(table_resum2) <- c("Variable","Mean", "Lower", "Upper")
```

```{r echo=FALSE, fig.align="center", fig.height=2.5, fig.pos='H', message=FALSE, warning=FALSE, comment=NA, fig.cap="Forest plot of late infarct growth",tinytex.verbose=TRUE}
par(font=1, cex=0.75)
forest(x=table_resum2$Mean,
       ci.lb=table_resum2$Lower,
       ci.ub=table_resum2$Upper,
       slab=table_resum2$Variable,
       pzise=0.75, refline=0, cex=1, efac=0.75, xlab="Additive increase in late infarct growth",
       header=c("Late infarct growth model", "Estimate [95% CI]"))
```

```{r include=FALSE}
table_resum3_col1 <- c(as.numeric(res1.t$confint[1]),
              as.numeric(res2.t$confint[1]),
              as.numeric(res3.t$confint[1]),
              as.numeric(res4.t$confint[1]))

table_resum3_col2 <- c(as.numeric(res1.t$confint[2]),
              as.numeric(res2.t$confint[2]),
              as.numeric(res3.t$confint[2]),
              as.numeric(res4.t$confint[2]))

table_resum3_col3 <- c(as.numeric(res1.t$confint[3]),
              as.numeric(res2.t$confint[3]),
              as.numeric(res3.t$confint[3]),
              as.numeric(res4.t$confint[3]))

table_resum3_col4 <- c("Time to recanalization:TICI<2b", "Time to recanalization:TICI>=2b", "TMax6 vol post:TICI<2b", "TMax6 vol post:TICI>=2b")

table_resum3 <- data.frame(table_resum3_col4,table_resum3_col1,table_resum3_col2,table_resum3_col3)
colnames(table_resum3) <- c("Variable","Mean", "Lower", "Upper")
```

```{r echo=FALSE, fig.align="center", fig.height=2.5, fig.pos='H', message=FALSE, warning=FALSE, fig.cap="Forest plot of total infarct growth",comment=NA, tinytex.verbose=TRUE}
par(font=1, cex=0.75)
forest(x=table_resum3$Mean,
       ci.lb=table_resum3$Lower,
       ci.ub=table_resum3$Upper,
       slab=table_resum3$Variable,
       pzise=0.75, refline=0, cex=1, efac=0.75, xlab="Additive increase in total infarct growth",
       header=c("Total infarct growth model", "Estimate [95% CI]"))
```

&nbsp;

### Multivariate models with infarct volumes

First of all, univariate models are made to explore relationships between infarct volumes (Table 11).

```{r include=FALSE}
set.seed(2021)
imp <- mice(dades, predictorMatrix=m, method=c(rep("pmm",14),"","",""))
```

```{r include=FALSE}
model_uni1 <- lm(d$Log_V_post_EVT~d$Log_V_pre_EVT)
summ(model_uni1, confint=T)

model_uni2 <- lm(d$Log_V_5d~d$Log_V_post_EVT)
summ(model_uni2, confint=T)

model_uni3 <- lm(d$Log_V_5d~d$Log_V_pre_EVT)
summ(model_uni3, confint=T)
```

```{r include=FALSE}
table11_col1 <- c("log(Infarct volume pre EVT)", "log(Infarct volume post) EVT")

table11_col2 <- c("0.73 [0.56, 0.90]","")

table11_col3 <- c("", "0.87 [0.73, 1.00]")

table11_col4 <- c("0.52 [0.3, 0.74]","")

table11 <- data.frame(table11_col1, table11_col2, table11_col3, table11_col4)
                     
colnames(table11)<- c("", "Post vs Pre", "5d vs Post", "5d vs Pre")
```

```{r echo=FALSE}
kable(table11, align= c('l', 'c', 'c', 'c'), caption = "Coefficient point estimates and 95\\% CI of the univariate models using only infarct volumes", booktabs = T, linesep="") %>%
  row_spec(0, bold=T, color= "black") %>%
  kable_styling(latex_options = c("striped","hold_position"), stripe_index = c(1), font_size = 10)
#   row_spec(0, bold=T, color= "black")
```

```{r eval=FALSE, include=FALSE}
# POST VS PRE
fit0 <- with(imp, lm(Log_V_post_EVT~Log_V_pre_EVT))
summary(pool(fit0))
anova(fit0$analyses[[1]])

fit1 <- with(imp, lm(Log_V_post_EVT~Log_V_pre_EVT*TICI_equal_higher2B))
summary(pool(fit1))
anova(fit1$analyses[[1]])
anova(fit0,fit1, use="likelihood", method="D3")

fit2 <- with(imp, lm(Log_V_post_EVT~Log_V_pre_EVT*TICI_equal_higher2B+HIR_pre_EVT*TICI_equal_higher2B))
summary(pool(fit2))
anova(fit2$analyses[[1]])

fit2.1 <- with(imp, lm(Log_V_post_EVT~Log_V_pre_EVT*TICI_equal_higher2B+HIR_pre_EVT))
summary(pool(fit2.1))
anova(fit2.1$analyses[[1]])

anova(fit2.1,fit2, use="likelihood", method="D3")
anova(fit1,fit2.1, use="likelihood", method="D3")

fit3 <- with(imp, lm(Log_V_post_EVT~Log_V_pre_EVT*TICI_equal_higher2B+HIR_pre_EVT+num_passes*TICI_equal_higher2B))
summary(pool(fit3))
anova(fit3$analyses[[1]])
anova(fit2.1, fit3, use="likelihood", method="D3")

fit4 <- with(imp, lm(Log_V_post_EVT~Log_V_pre_EVT*TICI_equal_higher2B+HIR_pre_EVT+num_passes*TICI_equal_higher2B+imaging_recan*TICI_equal_higher2B))
summary(pool(fit4))
anova(fit4$analyses[[1]])
anova(fit3,fit4, use="likelihood", method="D3")

fit5 <- with(imp, lm(Log_V_post_EVT~Log_V_pre_EVT*TICI_equal_higher2B+num_passes*TICI_equal_higher2B+imaging_recan*TICI_equal_higher2B))
summary(pool(fit5))
anova(fit5$analyses[[1]])
anova(fit5,fit4, use="likelihood", method="D3")

# 5d vs POST
m0 <- with(imp, lm(Log_V_5d~Log_V_post_EVT))
summary(pool(m0))
anova(m0$analyses[[1]])

m1 <- with(imp, lm(Log_V_5d~Log_V_post_EVT*TICI_equal_higher2B))
summary(pool(m1))
anova(m1$analyses[[1]])
anova(m0,m1, use="likelihood", method="D3")

m2 <- with(imp, lm(Log_V_5d~Log_V_post_EVT*TICI_equal_higher2B+imaging_recan*TICI_equal_higher2B))
summary(pool(m2))
anova(m2$analyses[[1]])

m2.1 <- with(imp, lm(Log_V_5d~Log_V_post_EVT*TICI_equal_higher2B+imaging_recan))
summary(pool(m2.1))
anova(m2.1$analyses[[1]])

anova(m1,m2.1, use="likelihood", method="D3")

m3 <- with(imp, lm(Log_V_5d~Log_V_post_EVT*TICI_equal_higher2B+oclus_post_EVT*TICI_equal_higher2B))
summary(pool(m3))
anova(m3$analyses[[1]])

m3.1 <- with(imp, lm(Log_V_5d~Log_V_post_EVT*TICI_equal_higher2B+oclus_post_EVT))
summary(pool(m3.1))
anova(m3.1$analyses[[1]])

anova(m1,m3.1, use="likelihood", method="D3")

m4 <- with(imp, lm(Log_V_5d~Log_V_post_EVT*TICI_equal_higher2B+oclus_post_EVT+TMax_6s_post_EVT*TICI_equal_higher2B))
summary(pool(m4))
anova(m4$analyses[[1]])

anova(m3.1,m4, use="likelihood", method="D3")

m5 <- with(imp, lm(Log_V_5d~Log_V_post_EVT*TICI_equal_higher2B+TMax_6s_post_EVT*TICI_equal_higher2B))
summary(pool(m5))
anova(m5$analyses[[1]])

anova(m5,m4, use="likelihood", method="D3")

# 5d vs PRE
mod0 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT))
summary(pool(mod0))
anova(mod0$analyses[[1]])

mod1 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT*TICI_equal_higher2B))
summary(pool(mod1))
anova(mod1$analyses[[1]])
anova(mod0,mod1, use="likelihood", method="D3")

mod2 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT*TICI_equal_higher2B+imaging_recan*TICI_equal_higher2B))
summary(pool(mod2))
anova(mod2$analyses[[1]])

mod2.1 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT*TICI_equal_higher2B+imaging_recan))
summary(pool(mod2.1))
anova(mod2.1$analyses[[1]])

anova(mod1,mod2.1, use="likelihood", method="D3")

mod3 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT*TICI_equal_higher2B+num_passes*TICI_equal_higher2B))
summary(pool(mod3))
anova(mod3$analyses[[1]])

mod3.1 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT*TICI_equal_higher2B+num_passes))
summary(pool(mod3.1))
anova(mod3.1$analyses[[1]])

anova(mod1,mod3.1, use="likelihood", method="D3")

mod4 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT*TICI_equal_higher2B+num_passes+oclus_post_EVT*TICI_equal_higher2B))
summary(pool(mod4))
anova(mod4$analyses[[1]])

mod4.1 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT*TICI_equal_higher2B+num_passes+oclus_post_EVT))
summary(pool(mod4.1))
anova(mod4.1$analyses[[1]])

anova(mod3.1,mod4.1, use="likelihood", method="D3")

mod5 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT*TICI_equal_higher2B+num_passes+oclus_post_EVT+TMax_6s_post_EVT*TICI_equal_higher2B))
summary(pool(mod5))
anova(mod5$analyses[[1]])
anova(mod4.1,mod5, use="likelihood", method="D3")

mod6 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT*TICI_equal_higher2B+num_passes+TMax_6s_post_EVT*TICI_equal_higher2B))
summary(pool(mod6))
anova(mod6$analyses[[1]])
anova(mod6,mod5, use="likelihood", method="D3")
```

```{r include=FALSE}
# FINAL MODEL POST VS PRE
set.seed(2021)
fit4 <- with(imp, lm(Log_V_post_EVT~Log_V_pre_EVT*TICI_equal_higher2B+num_passes*TICI_equal_higher2B+imaging_recan*TICI_equal_higher2B))
summary(pool(fit4))
anova(fit4$analyses[[1]])
model.post.pre <- fit4$analyses[[1]]
summ(model.post.pre, confint=T)

fit4.1 <- with(imp, lm(Log_V_post_EVT~Log_V_pre_EVT+TICI_equal_higher2B+num_passes+imaging_recan))
car::vif(fit4.1$analyses[[1]])
```

```{r include=FALSE}
# FINAL MODEL 5D VS POST
set.seed(2021)
m4 <- with(imp, lm(Log_V_5d~Log_V_post_EVT*TICI_equal_higher2B+TMax_6s_post_EVT*TICI_equal_higher2B))
summary(pool(m4))
anova(m4$analyses[[1]])
model.5d.post <- m4$analyses[[1]]
summ(model.5d.post, confint=T)

m4.1 <- with(imp, lm(Log_V_5d~Log_V_post_EVT+TICI_equal_higher2B+TMax_6s_post_EVT))
car::vif(m4.1$analyses[[1]])
```

```{r include=FALSE}
# FINAL MODEL 5D VS PRE
set.seed(2021)
mod5 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT*TICI_equal_higher2B+num_passes+TMax_6s_post_EVT*TICI_equal_higher2B))
summary(pool(mod5))
anova(mod5$analyses[[1]])
model.5d.pre <- mod5$analyses[[1]]
summ(model.5d.pre, confint=T)

mod5.1 <- with(imp, lm(Log_V_5d~Log_V_pre_EVT+TICI_equal_higher2B+num_passes+TMax_6s_post_EVT))
car::vif(mod5.1$analyses[[1]])
```

```{r include=FALSE}
table12_col1 <- c("log(Infarct volume pre EVT)", "log(Infarct volume post EVT)", "TICI>=2B",
                 "Number of passes","Time image to recanalization",
                 "TMax6 volume post", "log(Infarct vol. pre EVT):TICI>=2B", "Number of passes:TICI>=2B","Time image to recanalization:TICI>=2B",
                 "TMax6 volume post:TICI>=2B", "log(Infarct vol. post EVT):TICI>=2B")

table12_col2 <- c("0.18 [-0.11, 0.47]","", "0.06 [-1.64, 1.77]", "0.47 [0.26, 0.69]", "0.011 [0.002, 0.019]", "", "0.71 [0.39, 1.02]", "-0.34 [-0.58, -0.09]","-0.012 [-0.022, -0.003]", "", "")

table12_col3 <- c("-0.01 [-0.39, 0.38]", "","-3.77 [-5.05, -2.49]", "0.18 [0.08, 0.28]", "", "-0.003 [-0.012, 0.007]", "0.70 [0.29, 1.12]", "","", "0.021 [0.009, 0.033]", "")

table12_col4 <- c("", "0.36 [0.01, 0.72]", "-2.82 [-4.76, -0.88]", "", "", "-0.003 [-0.01, 0.005]","", "", "", "0.014 [0.005, 0.023]", "0.45 [0.06, 0.83]")

table12 <- data.frame(table12_col1, table12_col2, table12_col4, table12_col3)
                     
colnames(table12)<- c("", "Post vs Pre", "5d vs Post", "5d vs Pre")
```

Table 12 shows the coefficient point estimates and 95% CI of the parameters of each variable. More detailed information about each of these models is included in the Appendix 2.

```{r echo=FALSE}
kable(table12, align= c('l', 'c', 'c', 'c'), caption = "Coefficient point estimates and 95\\% CI of the multivariate models using infarct volumes", booktabs = T, linesep="") %>%
  row_spec(0, bold=T, color= "black") %>%
  kable_styling(latex_options = c("scale_down", "striped","hold_position"), stripe_index = c(1,3,5,7,9,11), full_width=F,font_size = 10)
#   row_spec(0, bold=T, color= "black")
```

First, for the model of _Post vs Pre_, the R-squared obtained is 0.75. Compared with the previous model for the early infarct growth, which had an R-squared of 0.33, this one seems to have a better proportion of the total variability of the endogenous variable explained by the model. Besides, 5 observations are deleted because missing values in the infarct volumes post-procedure are found. However, this model has lesser missing values because a previous imputation of missing values for the predictors is performed. This model has the following relevant variables: the interactions between the logarithm of the infarct volume pre EVT, the number of passes and the time image to recanalization, each one with the variable TICI grade. 

Second, for the model of _5d vs Post_, the R-squared obtained is 0.79. Compared with the previous model for the late infarct growth, which had an R-squared of 0.57, this one seems to have a better proportion of the total variability of the endogenous variable explained by the model. Besides, 25 observations are deleted because missing values in the infarct volumes, post EVT and on day 5, are found (imputation of missing values for the predictors is also performed). This model has the following relevant variables: the interactions between the logarithm of the infarct volume post EVT and the TMax6s volume post, both with the variable TICI grade. 

Last, for the model of 5d vs Pre the R-squared obtained is 0.71. Compared with the previous model for the total infarct growth, which had an R-squared of 0.7, they seem to have the same proportion of the total variability of the endogenous variable explained. Besides, 21 observations are deleted because missing values are found in the infarct volumes on day 5 (imputation of missing values for the predictors is also performed). This model has the following relevant variables: the number of passes and the interactions between the logarithm of the infarct volume pre EVT and the variable TMax6 volume post EVT, both with the variable TICI grade.

Neither of these three models has problems of multicollinearity (VIFs are calculated). 

In order to facilitate the interpretation, table 13 contains the exponentiated coefficients.

\newpage

```{r include=FALSE}
table13_col1 <- c("log(Infarct volume pre EVT)", "log(Infarct volume post EVT)", "TICI>=2B",
                 "Number of passes","Time image to recanalization",
                 "TMax6 volume post", "log(Infarct vol. pre EVT):TICI>=2B", "Number of passes:TICI>=2B","Time image to recanalization:TICI>=2B",
                 "TMax6 volume post:TICI>=2B", "log(Infarct vol. post EVT):TICI>=2B")

table13_col2 <- c("1.19 [0.89, 1.59]","", "1.06 [0.19, 5.86]", "1.61 [1.29, 2]", "1.011 [1.002, 1.02]", "", "2.03 [1.48, 2.78]", "0.71 [0.56, 0.91]","0.988 [0.978, 0.998]", "", "")

table13_col3 <- c("0.99 [0.68, 1.46]", "","0.02 [0.01, 0.08]", "1.2 [1.09, 1.32]", "", "0.997 [0.988, 1.007]", "2.02 [1.33, 3.05]", "","", "1.021 [1.009, 1.033]", "")

table13_col4 <- c("", "1.44 [1.01, 2.06]", "0.06 [0.01, 0.41]", "", "", "0.997 [0.99, 1.005]","", "", "", "1.014 [1.005, 1.023]", "1.56 [1.06, 2.29]")

table13 <- data.frame(table13_col1, table13_col2, table13_col4, table13_col3)
                     
colnames(table13)<- c("", "Post vs Pre", "5d vs Post", "5d vs Pre")
```

```{r echo=FALSE}
kable(table13, align= c('l', 'c', 'c', 'c'), caption = "Exponentiated coefficient point estimates and 95\\% CI of the multivariate models using infarct volumes", booktabs = T, linesep="") %>%
  row_spec(0, bold=T, color= "black") %>%
  kable_styling(latex_options = c("scale_down", "striped","hold_position"), stripe_index = c(1,3,5,7,9,11), full_width=F,font_size = 10)
#   row_spec(0, bold=T, color= "black")
```

```{r message=FALSE, warning=FALSE, comment=F, include=FALSE}

##############
# POST VS PRE:
##############

# V_pre
res1.e <- confint(glht(model.post.pre, linfct=t(c(0,1,0,0,0,0,0,0))))
exp(as.numeric(res1.e$confint))^log(1.1)

res2.e <- confint(glht(model.post.pre, linfct=t(c(0,1,0,0,0,1,0,0))))
exp(as.numeric(res2.e$confint))^log(1.1)

# num_passes
res3.e <- confint(glht(model.post.pre, linfct=t(c(0,0,0,1,0,0,0,0))))
exp(as.numeric(res3.e$confint))

res4.e <- confint(glht(model.post.pre, linfct=t(c(0,0,0,1,0,0,1,0))))
exp(as.numeric(res4.e$confint))

# time image to recan
res5.e <- confint(glht(model.post.pre, linfct=t(c(0,0,0,0,1,0,0,0))))
exp(as.numeric(res5.e$confint)*5)

res6.e <- confint(glht(model.post.pre, linfct=t(c(0,0,0,0,1,0,0,1))))
exp(as.numeric(res6.e$confint)*5)

#######
# LATE:
#######

# V_post
res1.l <- confint(glht(model.5d.post, linfct=t(c(0,1,0,0,0,0))))
exp(as.numeric(res1.l$confint))^log(1.1)

res2.l <- confint(glht(model.5d.post, linfct=t(c(0,1,0,0,1,0))))
exp(as.numeric(res2.l$confint))^log(1.1)

# TMAX
res3.l <- confint(glht(model.5d.post, linfct=t(c(0,0,0,1,0,0))))
exp(as.numeric(res3.l$confint))

res4.l <- confint(glht(model.5d.post, linfct=t(c(0,0,0,1,0,1))))
exp(as.numeric(res4.l$confint))

#######
# TOTAL:
#######

# V_pre
res1.t <- confint(glht(model.5d.pre, linfct=t(c(0,1,0,0,0,0,0))))
exp(as.numeric(res1.t$confint))^log(1.1)

res2.t <- confint(glht(model.5d.pre, linfct=t(c(0,1,0,0,0,1,0))))
exp(as.numeric(res2.t$confint))^log(1.1)

# Num_passes
res3.t <- confint(glht(model.5d.pre, linfct=t(c(0,0,0,1,0,0,0))))
exp(as.numeric(res3.t$confint))

# TMAX
res4.t <- confint(glht(model.5d.pre, linfct=t(c(0,0,0,0,1,0,0))))
exp(as.numeric(res4.t$confint))

res5.t <- confint(glht(model.5d.pre, linfct=t(c(0,0,0,0,1,0,1))))
exp(as.numeric(res5.t$confint))
```

For regression model _Post vs Pre_, an increase of 10% in infarct volume pre EVT is related to a punctual increase of 1.7%, with a 95% CI of [-1.06%, 4.54%], in infarct volume post EVT for TICI grades less than 2b. Even so, an increase of 10% in infarct volume pre EVT corresponds to an increase of 8.78% [7.45%, 10.14%] in infarct volume post EVT if TICI grades are equal or greater than 2b. The point estimates are obtained as follows:
$$1.19^{log(1.1)}=1.017$$ 
$$exp(0.18+0.71)^{log(1.1)}= 1.0878$$

The 95% CI are calculated taking into account the information of the variance-covariance matrix of the coefficients and assuming normality. 

Likewise, an increase of one pass is associated with an increase of 60.64% [29.06%, 99.96%] in the infarct volume post but only for patients with TICI less than 2b. However, it is related to an increase of 14.51% [2.33%, 28.14%] in infarct volume post EVT if TICI grades are equal or greater than 2b. The point estimates are obtained as follows:
$$ exp(0.47)=1.6064$$
$$exp(0.47-0.34)=1.1451$$

Also, an increase of 5 minutes in time image to recanalization is associated with an increase of 5.54% [1.13%, 10.15%] in the infarct volume post but only for patients with TICI less than 2b. On the contrary, it is related to a decrease of 0.73% [-1.65%, 3.05%] in infarct volume post EVT if TICI grades are equal or greater than 2b. The point estimates are obtained as follows:
$$exp(0.011·5)=1.0554 $$
$$exp[5·(0.011-0.012)]= 0.9927 $$

For regression model _5d vs Post_, an increase of 10% in infarct volume post EVT is associated with an increase of 3.54% [0.05%, 7.15%] in infarct volume on day 5 if TICI grades are less than 2b. Although, it is related to an increase of 8.04% [6.66%, 9.42%] in infarct volume on day 5 if TICI grades are equal or greater than 2b. 

Moreover, an increase of one unit in TMax6 volume post is associated with a decrease of 0.25% [-0.49%, 0.99%] in infarct volume on day 5 if TICI grades are less than 2b. However, it is related to an increase of 1.15% [0.59%, 1.74%] in infarct volume on day 5 if TICI grades are equal or greater than 2b.

For regression model _5d vs Pre_, an increase of 10% in infarct volume pre EVT associated with a decrease of 0.06% [-3.66%, 3.65%] in infarct volume on day 5 if TICI grades are less than 2b. Even so, it is related to an increase of 6.85% [5.28%, 8.45%] in infarct volume on day 5 if TICI grades are equal or greater than 2b. 

Likewise, an increase of one pass is associated with an increase of 19.80% [8.53%, 32.35%] in infarct volume post EVT when infarct volume pre EVT remains constant. It is important to mention that this can only be accepted for patients that have between one and three passes.

Furthermore, an increase of one unit in TMax6 volume post is related to a decrease of 0.27% [-0.69%, 1.22%] in infarct volume on day 5 if TICI grades are less than 2b. However, it is associated with an increase of 1.84% [1.17%, 2.51%] in infarct volume on day 5 if TICI grades are equal or greater than 2b.

Besides, an interpretation and graphical representation of all the effects of each regression model using infarct volumes is made in tables 14 and 15 and figure 20.

```{r eval=FALSE, fig.align="center", fig.cap="", message=FALSE, warning=FALSE, comment=NA, include=FALSE, tinytex.verbose=TRUE}
CLD(emmeans(model.post.pre,~num_passes|TICI_equal_higher2B, at=list(num_passes=c(min(d$num_passes, na.rm=T), median(d$num_passes, na.rm=T), max(d$num_passes, na.rm=T)))), Letters=letters, reversed=T)

CLD(emmeans(model.post.pre,~Log_V_pre_EVT|TICI_equal_higher2B, at=list(Log_V_pre_EVT=c(min(d$Log_V_pre_EVT, na.rm=T), median(d$Log_V_pre_EVT, na.rm=T), max(d$Log_V_pre_EVT, na.rm=T)))), Letters=letters, reversed=T)

CLD(emmeans(model.post.pre,~imaging_recan|TICI_equal_higher2B, at=list(imaging_recan=c(min(d$imaging_recan, na.rm=T), median(d$imaging_recan, na.rm=T), max(d$imaging_recan, na.rm=T)))), Letters=letters, reversed=T)

CLD(emmeans(model.5d.post,~Log_V_post_EVT|TICI_equal_higher2B, at=list(Log_V_post_EVT=c(min(d$Log_V_post_EVT, na.rm=T), median(d$Log_V_post_EVT, na.rm=T), max(d$Log_V_post_EVT, na.rm=T)))), Letters=letters, reversed=T)

CLD(emmeans(model.5d.post,~TMax_6s_post_EVT|TICI_equal_higher2B, at=list(TMax_6s_post_EVT=c(min(d$TMax_6s_post_EVT, na.rm=T), median(d$TMax_6s_post_EVT, na.rm=T), max(d$TMax_6s_post_EVT, na.rm=T)))), Letters=letters, reversed=T)

CLD(emmeans(model.5d.pre,~num_passes, at=list(num_passes=c(min(d$num_passes, na.rm=T), median(d$num_passes, na.rm=T), max(d$num_passes, na.rm=T)))), Letters=letters, reversed=T)

CLD(emmeans(model.5d.pre,~Log_V_pre_EVT|TICI_equal_higher2B, at=list(Log_V_pre_EVT=c(min(d$Log_V_pre_EVT, na.rm=T), median(d$Log_V_pre_EVT, na.rm=T), max(d$Log_V_pre_EVT, na.rm=T)))), Letters=letters, reversed=T)

CLD(emmeans(model.5d.pre,~TMax_6s_post_EVT|TICI_equal_higher2B, at=list(TMax_6s_post_EVT=c(min(d$TMax_6s_post_EVT, na.rm=T), median(d$TMax_6s_post_EVT, na.rm=T), max(d$TMax_6s_post_EVT, na.rm=T)))), Letters=letters, reversed=T)
```

```{r include=FALSE}
table14_col1 <- c("Number of passes", "", "")

table14_col2 <- c("10", "2", "1")

table14_col3 <- c("230.44 [96.54, 555.573]", "54.6 [29.67, 99.48]", "45.6 [24.05, 85.63]")

table14_col4 <- c("a", "b", "c")

table14 <- data.frame(table14_col1, table14_col2, table14_col3, table14_col4)

colnames(table14) <- c("", "", "Estimate", "Group")
```

As the number of passes in the _5d vs Pre_ model is the only effect that does not interact with the TICI grade, is shown in a separate table (Table 14).

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table14, align= c('l', 'c', 'c', 'c'), caption = "Volume predictions on day 5 for the 5d versus Pre model according to some different number of passes",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 8) %>%
  row_spec(0, bold=T, color= "black") %>%
  add_header_above(c("Variable","Value", "5d vs Pre"=2), bold=T) 
# %>%column_spec(1, width = "2.75cm")
```

For the regression model _5d vs Pre_, the variable number of passes has significant differences between the minimum, the median and the maximum. 

```{r include=FALSE}
table15_col1 <- c("Infarct vol. pre EVT", "","", "","","","Number of passes","","","","","","Time image to rec.", "","","","","","TMax6 volume post","","","", "", "","Infarct vol. post EVT", "","", "","","")

table15_col2 <- c("154.47", "11.94", "0.17", "154.47", "11.94", "0.17", "10","2","1","10","2","1","245","102", "45", "245", "102", "45", "207", "3", "0.01", "207", "3", "0.01", "298.87", "19.89", "0.33", "298.87", "19.89", "0.33")

table15_col9 <- c("TICI<2b", "","" ,"TICI>=2b", "", "","TICI<2b", "", "", "TICI>=2b", "", "","TICI<2b", "", "", "TICI>=2b", "", "","TICI<2b", "", "", "TICI>=2b", "", "", "TICI<2b", "","", "TICI>=2b", "", "")

table15_col3 <- c("33.78 [11.36, 101.8]", "21.54 [11.59, 40.33]", "10.18 [3.06, 33.82]", "145.47 [99.48, 211.88]","15.18 [12.81, 17.96]", "0.36 [0.2, 0.63]","788.4 [159.17, 3866.09]","17.64 [9.3, 33.78]", "11.02 [5.16, 23.57]", "37.71 [15.8, 90.92]", "12.81 [10.7, 15.33]", "11.13 [8.85, 14.15]", "88.23 [37.34, 210.61]", "18.92 [9.68, 37.34]", "10.28 [3.49, 30.27]", "14.88 [10.7, 20.7]", "13.6 [11.59, 16.12]", "11.02 [5.58, 21.98]", "", "", "", "", "", "",  "", "", "", "", "", "")

table15_col4 <- c("a", "a", "a", "a","b", "c","a","b", "c", "a","b", "c","a","b", "c", "a","a","a", "", "","", "","","", "", "", "", "", "", "")

table15_col5 <- c("", "", "", "", "", "","", "", "", "", "", "","", "", "", "", "", "",
                  "59.15 [29.08, 120.3]", "99.48 [31.39, 317.35]", "100.48 [30.88, 327.01]", "223.63 [71.52, 699.24]", "21.76 [18.36, 26.05]", "21.12 [17.46, 25.28]",
                  "264.54 [100.08, 699.24]", "98.49 [37.75, 256.98]", "21.96 [2.62, 183.83]", "302.48 [197.75, 462.2]", "33.68 [27.94, 40.61]","1.2 [0.68, 2.11]")

table15_col6 <- c("", "", "", "", "", "","", "", "", "", "", "","", "", "", "", "", "", "a", "a", "a", "a", "b", "c","a", "a", "a", "a", "b", "c" )

table15_col7 <- c("125.59 [32.01, 492.75]", "122.12 [36.97, 403.43]", "120.18 [17.41, 828.82]", "173.82 [110.72, 273.14]", "29.31 [23.83, 36.23]", "1.53 [0.77, 3.06]", "", "", "", "", "", "", "", "", "", "", "", "", "131.63 [31.82, 550.04]", "131.63 [32.46, 533.79]", "75.19 [33.45, 169.02]", "713.37 [196.37, 2565.73]", "17.29 [14.15, 20.91]", "16.28 [13.33, 19.89]", "", "", "", "", "", "")

table15_col8 <- c("a", "a", "a", "a", "b", "c", "", "", "", "", "", "", "", "", "", "", "", "", "a","a", "a", "a", "b", "c", "", "", "", "", "", "")

table15 <- data.frame(table15_col1, table15_col2, table15_col9, table15_col3, table15_col4, table15_col5, table15_col6, table15_col7, table15_col8)
colnames(table15) <- c("", "","", "Estimate", "Group", "Estimate", "Group", "Estimate", "Group")
```

The volume predictions for the three models according to the TICI grade for those variable that presented interaction are shown in table 15.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table15, align= c('l', 'c', 'c', 'c', 'c','c','c','c','c'), caption = "Volume predictions for all models according to the TICI grade for those variables that presented interaction",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position", "scale_down", "striped"), stripe_index = c(1:6,13:18, 25:30), full_width=F, font_size = 8) %>%
  row_spec(0, bold=T, color= "black") %>%
  add_header_above(c("Variable","Value", "TICI","Post vs Pre" = 2, "5d vs Post"=2,
 "5d vs Pre"=2), bold=T) 
# %>%column_spec(1, width = "2.75cm")
```

For the _Post vs Pre_ and _5d vs Pre_ models, the variable infarct volume pre EVT has significant differences between the minimum, the median and the maximum when TICI grades are greater than or equal to 2b (Table 15).

Also, for the _Post vs Pre_, the variable number of passes has significant differences between the minimum, the median and the maximum. Moreover, the variable time image to recanalization has significant differences between the minimum, the median and the maximum when TICI grades are less than 2b.

Moreover, for the _5d vs Post_ and _5d vs Pre_ models, the variable TMax6 volume post has significant differences between the minimum, the median and the maximum when TICI grades are greater than or equal to 2b. 

Finally, for the _5d vs Post_ model, the variable infarct volume post EVT has significant differences between the minimum, the median and the maximum when TICI grades are greater than or equal to 2b.

\newpage

```{r echo=FALSE, fig.height=3, fig.width=6}
eff2.t <- effect_plot(model.5d.pre, pred = num_passes, interval = TRUE, plot.points = TRUE, x.label="Number of passes", y.label="5d vs pre", colors=brewer.pal(9, "Blues")[c(9)], point.color=brewer.pal(9, "Blues")[c(9)])

eff3.e <- interact_plot(model.post.pre, pred = Log_V_pre_EVT, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Infarct volume pre EVT", y.label="Post vs pre", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff1.e <- interact_plot(model.post.pre, pred = num_passes, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Number of passes", y.label="Post vs pre", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff4.e <- interact_plot(model.post.pre, pred = imaging_recan, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Time image to recanalization (minutes)", y.label="Post vs pre", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff3.l <- interact_plot(model.5d.post, pred = Log_V_post_EVT, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Infarct volume post EVT", y.label="5d vs post", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff4.l <- interact_plot(model.5d.post, pred =TMax_6s_post_EVT, modx=TICI_equal_higher2B,interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="TMax6 volume post", y.label="5d vs post", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff5.t <- interact_plot(model.5d.pre, pred = Log_V_pre_EVT, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Infarct volume pre EVT", y.label="5d vs pre", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff6.t <- interact_plot(model.5d.pre, pred = TMax_6s_post_EVT, modx=TICI_equal_higher2B, interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="TMax6 volume post", y.label="5d vs pre", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])
```

```{r echo=FALSE, fig.align="center", fig.height=2.5,fig.width=7, message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, result='asis'}

grid.arrange(eff3.e+ theme(legend.position = "non2"), eff4.e+ theme(legend.position = "non2"), ncol=2)
```

\newpage

```{r echo=FALSE, fig.align="center", fig.height=7,fig.width=7, message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Association plots for Post vs Pre model", result='asis'}

###########################
# FIGURE 17 ~ Effect plots:
###########################

legend_b <- get_legend(eff4.l)

grid.arrange(eff1.e+ theme(legend.position = "non2"),eff3.l+ theme(legend.position = "non2"), eff4.l+ theme(legend.position = "non2"), eff5.t+ theme(legend.position = "non2"), eff6.t+ theme(legend.position = "non2"), eff2.t+ theme(legend.position = "non2"),ncol=2, legend_b)
```

The validation of each regression model using infarct volumes is made below.

First, the graphic of residuals versus fitted values serves to validate the _Post vs Pre_ model. In this case, as shown in figure 21, there seems to be a slightly heteroscedastic pattern. Besides, there is a curvilinear pattern, which indicates that the model may be missing a higher order term. Although, no variable in this model has a significant parameter into adding a higher order term. 

Figure 22 shows that the observation 59 has the highest Cook's distance, observations 19 and 59 have the highest hat-values and observations 24, 14 and 17 have the highest studentized residuals in this model. For this reason, outlier tests are provided, showing that observations 24, 14 and 17 should be considered outliers (Table 16).

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=3,  tinytex.verbose=TRUE, comment=NA, fig.cap="Residuals vs fitted values for the Post vs Pre model", result='asis'}
residualPlot(model.post.pre, layout=c(3, 2), tests=T)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=5,  tinytex.verbose=TRUE, comment=NA, fig.cap="Diagnostic plots for the Post vs Pre model"}
influenceIndexPlot(model.post.pre,vars=c("Cook", "Student","hat"), id=list(n=5))
```

```{r include=FALSE}
#outlierTest(model.post.pre)

table16_col1 <- c("-4.425948", "-4.154438", "-3.790263")
table16_col2 <- c("2.8656e-05", "7.8038e-05", "2.8232e-04")
table16_col3 <- c("0.0026650", "0.0072576", "0.0262560")
table16 <- data.frame(table16_col1, table16_col2, table16_col3)
rownames(table16) <- c("24", "14", "17")
colnames(table16) <- c("Rstudent", "Unadjusted p-value","Bonferroni p")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table16, align= c('c', 'c','c'), caption = "Outlier test for the Post vs Pre model",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 8) %>%
  row_spec(0, bold=T, color= "black")
```

Second, the graphic of residuals versus fitted values serves to validate the _5d vs Post_ model. As shown in figure 23, the residuals roughly form a horizontal band around the residual line, which means that homoscedasticity might be assumed. Besides, there is a slightly curvilinear pattern, which is not fixed when adding a higher order term.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=3,  tinytex.verbose=TRUE, comment=NA, fig.cap="Residuals vs fitted values for the 5d vs Post model", result='asis'}
residualPlot(model.5d.post, tests=T)
```

Figure 24 shows that observations 49 and 34 have the highest Cook's distance and that observation 49 has the highest studentized residuals and hat-values in this model. For this reason, outlier tests are provided, showing that observations 49 and 34 should be considered outliers (Table 17).

```{r include=FALSE}
#outlierTest(model.5d.post)

table17_col1 <- c("4.038863", "-3.705374")
table17_col2 <- c("0.00014247", "0.00043382")
table17_col3 <- c("0.010400	", "0.031669")
table17 <- data.frame(table17_col1, table17_col2, table17_col3)
rownames(table17) <- c("49", "34")
colnames(table17) <- c("Rstudent", "Unadjusted p-value","Bonferroni p")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table17, align= c('c', 'c','c'), caption = "Outlier test for the 5d vs Post model",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 8) %>%
  row_spec(0, bold=T, color= "black")
```

\newpage

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=5,  tinytex.verbose=TRUE, comment=NA, fig.cap="Diagnostic plots for the 5d vs Post model"}
influenceIndexPlot(model.5d.post,vars=c("Cook", "Student","hat"), id=list(n=5))
```

Last, the graphic of residuals versus fitted values serves to validate the _5d vs Pre_ model. In this case, as shown in figure 25, the residuals roughly form a horizontal band around the residual line, which means that homoscedasticity might be assumed. Besides, the residuals have no obvious patterns or systematic structure, which means that linearity might also be assumed.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=3,  tinytex.verbose=TRUE, comment=NA, fig.cap="Residuals vs fitted values for the 5d vs Pre model", result='asis'}
residualPlot(model.5d.pre, layout=c(3, 2), tests=T)
```

Figure 26 shows that observation 49 and 34 have the highest Cook's distance and that observation 49 has the highest Cook's distance, observation 34 has the highest studentized residuals and observation 19 has the highest hat-values in this model. For this reason, outlier tests are provided, showing that observation 34 should be considered an outlier (Table 18).

```{r include=FALSE}
outlierTest(model.5d.pre)
table18 <- t(data.frame(c("-3.587642", "0.00061905", "0.047667")))
rownames(table18) <- c("34")
colnames(table18) <- c("Rstudent", "Unadjusted p-value","Bonferroni p")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table18, align= c('c', 'c','c'), caption = "Outlier test for the 5d vs Pre model",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 8) %>%
  row_spec(0, bold=T, color= "black")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=5,  tinytex.verbose=TRUE, comment=NA, fig.cap="Diagnostic plots for the 5d vs Pre model", fig.pos='H'}
influenceIndexPlot(model.5d.pre,vars=c("Cook", "Student","hat"), id=list(n=5))
```

To sum up, the forest plots of the _Post vs Pre_, the _5d vs Post_ and _5d vs Pre_ models are shown in figures 27, 28 and 29. It is important to mention that for the _Post vs Pre_ model an increase of 10% is shown for the logarithm of the infarct volume pre EVT and an increase of 5 minutes is shown in the variable time image to recanalization.

```{r include=FALSE}
table_resum1_col1 <- c(exp(as.numeric(res1.e$confint[1]))^log(1.1),
              exp(as.numeric(res2.e$confint[1]))^log(1.1),
              exp(as.numeric(res3.e$confint))[1],
              exp(as.numeric(res4.e$confint))[1],
              exp(as.numeric(res5.e$confint)*5)[1],
              exp(as.numeric(res6.e$confint)*5)[1])

exp(as.numeric(res1.e$confint))^log(1.1)

table_resum1_col2 <- c(exp(as.numeric(res1.e$confint[2]))^log(1.1),
              exp(as.numeric(res2.e$confint[2]))^log(1.1),
              exp(as.numeric(res3.e$confint))[2],
              exp(as.numeric(res4.e$confint))[2],
              exp(as.numeric(res5.e$confint)*5)[2],
              exp(as.numeric(res6.e$confint)*5)[2])

table_resum1_col3 <- c(exp(as.numeric(res1.e$confint[3]))^log(1.1),
              exp(as.numeric(res2.e$confint[3]))^log(1.1),
              exp(as.numeric(res3.e$confint))[3],
              exp(as.numeric(res4.e$confint))[3],
              exp(as.numeric(res5.e$confint)*5)[3],
              exp(as.numeric(res6.e$confint)*5)[3])

table_resum1_col4 <- c("log(Inf. vol. pre EVT):TICI<2b", "log(Inf. vol. pre EVT):TICI>=2b", "Number of passes:TICI<2b", "Number of passes:TICI>=2b", "Time image to recan:TICI<2b", "Time image to recan:TICI>=2b")

table_resum1 <- data.frame(table_resum1_col4,table_resum1_col1,table_resum1_col2,table_resum1_col3)
colnames(table_resum1) <- c("Variable","Mean", "Lower", "Upper")
```

```{r echo=FALSE, fig.align="center",  fig.height=2.75, fig.pos='H', message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Forest plot of Post vs Pre model"}
par(font=1, cex=0.75)
forest(x=table_resum1$Mean,
       ci.lb=table_resum1$Lower,
       ci.ub=table_resum1$Upper,
       slab=table_resum1$Variable,
       pzise=0.75, refline=1, cex=1, efac=0.75, xlab="Multiplicative increase in infarct volume post EVT",
       header=c("Post vs Pre model", "Estimate [95% CI]"))
```

```{r include=FALSE}
table_resum2_col1 <- c(exp(as.numeric(res1.l$confint[1]))^log(1.1),
              exp(as.numeric(res2.l$confint[1]))^log(1.1),
              exp(as.numeric(res3.l$confint))[1],
              exp(as.numeric(res4.l$confint))[1])

table_resum2_col2 <- c(exp(as.numeric(res1.l$confint[2]))^log(1.1),
              exp(as.numeric(res2.l$confint[2]))^log(1.1),
              exp(as.numeric(res3.l$confint))[2],
              exp(as.numeric(res4.l$confint))[2])

table_resum2_col3 <- c(exp(as.numeric(res1.l$confint[3]))^log(1.1),
              exp(as.numeric(res2.l$confint[3]))^log(1.1),
              exp(as.numeric(res3.l$confint))[3],
              exp(as.numeric(res4.l$confint))[3])

table_resum2_col4 <- c("log(Inf. vol. post EVT):TICI<2b", "log(Inf. vol. post EVT):TICI>=2b", "TMax vol. post:TICI<2b", "TMax vol. post:TICI>=2b")

table_resum2 <- data.frame(table_resum2_col4,table_resum2_col1,table_resum2_col2,table_resum2_col3)
colnames(table_resum2) <- c("Variable","Mean", "Lower", "Upper")
```

```{r echo=FALSE, fig.align="center", fig.height=2.75, fig.pos='H', message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Forest plot of 5d vs Post model"}
par(font=1, cex=0.75)
forest(x=table_resum2$Mean,
       ci.lb=table_resum2$Lower,
       ci.ub=table_resum2$Upper,
       slab=table_resum2$Variable,
       pzise=0.75, refline=1, cex=1, efac=0.75, xlab="Multiplicative increase in infarct volume on day 5",
       header=c("5d vs Post model", "Estimate [95% CI]"))
```

```{r include=FALSE}
table_resum3_col1 <- c(exp(as.numeric(res1.t$confint[1]))^log(1.1),
              exp(as.numeric(res2.t$confint[1]))^log(1.1),
              exp(as.numeric(res3.t$confint))[1],
              exp(as.numeric(res4.t$confint))[1],
              exp(as.numeric(res5.t$confint))[1])

table_resum3_col2 <- c(exp(as.numeric(res1.t$confint[2]))^log(1.1),
              exp(as.numeric(res2.t$confint[2]))^log(1.1),
              exp(as.numeric(res3.t$confint))[2],
              exp(as.numeric(res4.t$confint))[2],
              exp(as.numeric(res5.t$confint))[2])

table_resum3_col3 <- c(exp(as.numeric(res1.t$confint[3]))^log(1.1),
              exp(as.numeric(res2.t$confint[3]))^log(1.1),
              exp(as.numeric(res3.t$confint))[3],
              exp(as.numeric(res4.t$confint))[3],
              exp(as.numeric(res5.t$confint))[3])

table_resum3_col4 <- c("log(Inf. vol. pre EVT):TICI<2b", "log(Inf. vol. pre EVT):TICI>=2b", "Number of passes","TMax vol. post:TICI<2b", "TMax vol. post:TICI>=2b")

table_resum3 <- data.frame(table_resum3_col4,table_resum3_col1,table_resum3_col2,table_resum3_col3)
colnames(table_resum3) <- c("Variable","Mean", "Lower", "Upper")
```

```{r echo=FALSE, fig.align="center", fig.height=2.75, fig.pos='H', message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Forest plot of 5d vs Pre model"}
par(font=1, cex=0.75)
forest(x=table_resum3$Mean,
       ci.lb=table_resum3$Lower,
       ci.ub=table_resum3$Upper,
       slab=table_resum3$Variable,
       pzise=0.75, refline=1, cex=1, efac=0.75, xlab="Multiplicative increase in infarct volume on day 5",
       header=c("5d vs Pre model", "Estimate [95% CI]"))
```

## Generalized linear models

### Multivariate models with infarct volumes

Generalized linear models are applied to correct the problem of heteroscedasticity, to avoid logarithmic transformation and to have more flexibility when modeling, since these models allow a greater number of families. In this case, Gamma family and link identity are used.

Table 19 shows the estimations and the 95% CI of the parameters of each variable. More detailed information on each model is included in the Appendix 3.

```{r include=FALSE}
dd<-d[is.na(d$V_post_EVT)==F,] 
n<-2
dd$num<-dd$num_passes
dd$num[dd$num>n]<-n
dd$num<-as.factor(dd$num)

dd$num <- as.factor(ifelse(dd$num=="1", c("One pass"), c("More passes")))

row1 <- c(rep(1,14),0,0,0)
row2 <- rep(0,17)
m <- matrix(c(rep(row1,14), rep(row2,3)), ncol=17, byrow=T)
diag(m)=0

dades2 <- dd[c(10, 11, 12, 20, 21, 13, 15, 16, 67, 19, 14, 22, 24, 25, 2, 3, 4)]
imp2_glm <- mice(dades2, predictorMatrix=m, method=c(rep("pmm",14),"","",""))

mg <- with(imp2_glm, glm(V_post_EVT~V_pre_EVT+num*TICI_equal_higher2B, family=Gamma(link="identity")))

mg.1 <- with(imp2_glm, glm(V_post_EVT~V_pre_EVT+num+TICI_equal_higher2B, family=Gamma(link="identity")))

model.post.pre.glm <- mg$analyses[[1]]
Anova(model.post.pre.glm,test.statistic = "F")
summary(model.post.pre.glm)
summ(model.post.pre.glm, confint=T)

mg2 <- with(imp2_glm, glm(V_5d~V_post_EVT+oclus_post_EVT, family=Gamma(link="identity")))

model.5d.post.glm <- mg2$analyses[[1]]
Anova(model.5d.post.glm,test.statistic = "F")
summary(model.5d.post.glm)
summ(model.5d.post.glm, confint=T)

mg3 <- with(imp2_glm, glm(V_5d~V_pre_EVT*TICI_equal_higher2B+oclus_post_EVT, family=Gamma(link="identity")))

mg3.1 <- with(imp2_glm, glm(V_5d~V_pre_EVT+TICI_equal_higher2B+oclus_post_EVT, family=Gamma(link="identity")))

model.5d.pre.glm <- mg3$analyses[[1]]
Anova(model.5d.pre.glm,test.statistic = "F")
summary(model.5d.pre.glm)
summ(model.5d.pre.glm, confint=T)
```

```{r include=FALSE}
table19_col1 <- c("Infarct volume pre EVT", "Infarct volume post EVT","Number of passes (One pass)", "TICI>=2b", "Occlusion post","Infarct vol. pre EVT:TICI>=2b","Number of passes:TICI>=2b")

table19_col2 <- c("1.28 [1.01, 1.55]", "", "-82.86 [-125.05, -40.66]", "-81.97 [-123.86, -40.07]", "","", "79.55 [37.32, 121.79]")

table19_col3 <- c("", "1.20 [0.82, 1.59]", "", "", "38.81 [15.59, 62.03]", "", "")

table19_col4 <- c("-0.26 [-1.83, 1.30]", "", "", "-103.95 [-197.28, -10.63]", "48.43 [20.55, 76.31]", "1.41 [-0.23, 3.05]","")

table19 <- data.frame(table19_col1, table19_col2, table19_col3, table19_col4)
colnames(table19) <- c("", "Post vs Pre", "5d vs Post", "5d vs Pre")
```

```{r echo=FALSE}
kable(table19, align= c('l', 'c', 'c', 'c'), caption = "Coefficient point estimates and 95\\% CI of the multivariate generalized linear models using infarct volumes", booktabs = T, linesep="") %>%
  row_spec(0, bold=T, color= "black") %>%
  kable_styling(latex_options = c("scale_down", "striped","hold_position"), stripe_index = c(1,3,5,7), full_width=F,font_size = 10)
#   row_spec(0, bold=T, color= "black")
```

The Cragg-Uhler R-squared obtained are 0.76, 0.71 and 0.66, for the _Post vs Pre_, _5d vs Post_ and _5d vs Pre_, respectively.

A previous imputation of missing values for the predictors is performed. Nevertheless, missing values are found in these models because infarct volumes post-procedure are not included in the imputation.

First, for the _Post vs Pre_ model, the following relevant variables are found: infarct volume pre EVT and the interaction between the number of passes and TICI grades. Second, for the _5d vs Post_ model, the infarct volume post EVT and the occlusion are relevant. Last, for the _5d vs Pre_ model, the occlusion and the interaction between infarct volume pre EVT and the variable TICI grade are relevant. 

Neither of these three models has problems of multicollinearity (VIFs are calculated).

In addition, an interpretation and graphical representation of all the effects in each of the generalized linear models using infarct volumes is made in table 20 and figure 30.

Table 20 shows the volume predictions for the three generalized linear models, according to the TICI grade for those variable that presented interaction.

```{r eval=FALSE, fig.align="center", fig.cap="", message=FALSE, warning=FALSE, comment=NA, include=FALSE, tinytex.verbose=TRUE}
CLD(emmeans(model.post.pre.glm,~V_pre_EVT, at=list(V_pre_EVT=c(min(d$V_pre_EVT, na.rm=T), median(d$V_pre_EVT, na.rm=T), max(d$V_pre_EVT, na.rm=T)))), Letters=letters, reversed=T)

CLD(emmeans(model.post.pre.glm,~num|TICI_equal_higher2B), Letters=letters, reversed=T)

CLD(emmeans(model.5d.post.glm,~V_post_EVT, at=list(V_post_EVT=c(min(d$V_post_EVT, na.rm=T), median(d$V_post_EVT, na.rm=T), max(d$V_post_EVT, na.rm=T)))), Letters=letters, reversed=T)

CLD(emmeans(model.5d.post.glm,~oclus_post_EVT), Letters=letters, reversed=T)

CLD(emmeans(model.5d.pre.glm,~V_pre_EVT|TICI_equal_higher2B, at=list(V_pre_EVT=c(min(d$V_pre_EVT, na.rm=T), median(d$V_pre_EVT, na.rm=T), max(d$V_pre_EVT, na.rm=T)))), Letters=letters, reversed=T)

CLD(emmeans(model.5d.pre.glm,~oclus_post_EVT), Letters=letters, reversed=T)
```

```{r include=FALSE}
table20_col1 <- c("Infarct volume pre EVT", "","", "Infarct volume post EVT", "","","Occlusion", "","Number of passes","","","","Infarct volume pre EVT","","","","","")

table20_col2 <- c("154.734", "11.983", "0.172","297.658", "19.877", "0.325", "Yes","No","More passes", "One pass","More passes", "One pass", "154.734", "11.983", "0.172", "154.734", "11.983", "0.172")

table20_col9 <- c("", "", "","", "", "", "", "", "TICI<2b", "", "TICI>=2b", "", "TICI<2b", "", "", "TICI>=2b", "", "")

table20_col3 <- c("221.8 [180, 263.6]", "38.3 [27.3, 49.2]", "23.1 [12.3, 33.8]","", "", "", "","", "113.9 [71.3, 156.4]","31 [23.2, 38.9]", "31.6 [26.2, 37.1]", "28.6 [22.8, 34.4]","", "","","", "", "")

table20_col4 <- c("a", "b", "c","", "", "", "","", "a", "b", "a", "b","", "","","", "", "")

table20_col5 <- c("", "", "","380.4 [268.6, 492.2]", "45.9 [34.3, 57.5]", "22.3 [10.4, 34.3]", "81.4 [58.6, 104.1]","42.6 [30.6, 54.5]", "", "", "", "","", "","","", "", "")

table20_col6 <- c("", "","", "a", "b", "c", "a", "b", "", "", "", "","", "","","", "", "")

table20_col7 <- c("", "", "", "", "", "", "114.3 [71.3, 157]", "65.8 [24.1, 108]", "", "", "", "", "91.9 [-120.5, 304.4]", "129.2 [45.8, 212.5]", "132.3 [41.4, 223.1]", "206.1 [132.3, 279.9]", "42.1 [28.2, 56.1]", "28.5 [14.1, 43]")

table20_col8 <- c("", "", "", "", "", "", "a", "b", "", "", "", "", "a", "a", "a", "a", "b", "c")

table20 <- data.frame(table20_col1, table20_col2, table20_col9, table20_col3, table20_col4, table20_col5, table20_col6, table20_col7, table20_col8)
colnames(table20) <- c("", "","", "Estimate", "Group", "Estimate", "Group", "Estimate", "Group")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table20, align= c('l', 'c', 'c', 'c', 'c','c','c','c','c'), caption = "Volume predictions for the generalized linear models",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position", "scale_down", "striped"), stripe_index = c(1:3,7:8,13:18), full_width=F, font_size = 10) %>%
  row_spec(0, bold=T, color= "black") %>%
  add_header_above(c("Variable","Value", "TICI","Post vs Pre" = 2, "5d vs Post"=2,
 "5d vs Pre"=2), bold=T) 
# %>%column_spec(1, width = "2.75cm")
```

```{r echo=FALSE, fig.height=3, fig.width=6}
eff1.e <- effect_plot(model.post.pre.glm, pred = V_pre_EVT, interval = TRUE, plot.points = TRUE, x.label="Infarct volume pre EVT", y.label="Post vs pre", colors=brewer.pal(9, "Blues")[c(9)], point.color=brewer.pal(9, "Blues")[c(9)])

eff2.e <- cat_plot(model.post.pre.glm, pred = num, modx=TICI_equal_higher2B,  interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Number of passes", y.label="Post vs pre", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff1.l <- effect_plot(model.5d.post.glm, pred = V_post_EVT, interval = TRUE, plot.points = TRUE, x.label="Infarct volume post EVT", y.label="5d vs post", colors=brewer.pal(9, "Blues")[c(9)], point.color=brewer.pal(9, "Blues")[c(9)])

eff2.l <- effect_plot(model.5d.post.glm, pred = oclus_post_EVT, interval = TRUE, plot.points = TRUE, x.label="Occlusion post", y.label="5d vs post", colors=brewer.pal(9, "Blues")[c(9)], point.color=brewer.pal(9, "Blues")[c(9)])

eff1.t <- interact_plot(model.5d.pre.glm, pred =V_pre_EVT, modx=TICI_equal_higher2B,interval = TRUE, plot.points = TRUE, jitter=0.1, point.shape=T, x.label="Infarct volume pre EVT", y.label="5d vs pre", main.title="", colors=brewer.pal(9, "Blues")[c(9,6)])

eff2.t <- effect_plot(model.5d.pre.glm, pred = oclus_post_EVT, interval = TRUE, plot.points = TRUE, x.label="Occlusion post", y.label="5d vs pre", colors=brewer.pal(9, "Blues")[c(9)], point.color=brewer.pal(9, "Blues")[c(9)])
```

```{r echo=FALSE, fig.align="center", fig.height=8,fig.width=7, message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Association plots of the interactions", result='asis'}

legend_b <- get_legend(eff1.t)

grid.arrange(eff1.e+ theme(legend.position = "non2"), eff2.e+ theme(legend.position = "non2"), eff1.l+ theme(legend.position = "non2"), eff2.l+ theme(legend.position = "non2"), eff1.t+ theme(legend.position = "non2"), eff2.t+ theme(legend.position = "non2"),ncol=2, legend_b)
```

&nbsp;

For the _Post vs Pre_ model, the variable infarct volume pre EVT has significant differences between the minimum, the median and the maximum. The variable number of passes also has significant differences between these three values (Table 20).

Also, for the _5d vs Post_ model, the variable infarct volume post EVT has significant differences between the minimum, the median and the maximum. There are also significant differences between doing or not doing an occlusion.

Finally, for the _5d vs Pre_ model, there are significant differences between doing or not doing an occlusion. The variable infarct volume pre EVT has also significant differences between the minimum, the median and the maximum when TICI grades are greater than or equal to 2b. 

\newpage

The validation of each generalized linear model using infarct volumes is made below.

First, to validate the _Post vs Pre_ model, the graphic of residuals versus fitted values serves to assess heteroscedasticity. In this case, there seems to be a slightly heteroscedastic pattern (Figure 31). To ensure this fact, the Levene test is done. The resulted p-value is 0.16; this result lead to the non-rejection region of the null hypothesis. Consequently, homoscedasticity can be assumed. 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=3,  tinytex.verbose=TRUE, comment=NA, fig.cap="Residuals vs fitted values for Post vs Pre model", result='asis'}
residualPlot(model.post.pre.glm)
```

&nbsp;

Figure 32 shows that observation 45 has the highest Cook’s distance and hat-value and observation 21 has the highest studentized residuals in this model. Consequently, an outlier test is performed, showing that observation 21 should not be considered an outlier (Table 21).

```{r eval=FALSE, include=FALSE}
pr <- predict(model.post.pre, type="response")
quantile(pr, probs=c(0.25, 0.50, 0.75))
pr_cat2 <- cut(pr, breaks=c(min(pr), summary(pr)["1st Qu."][[1]], summary(pr)["Median"][[1]],summary(pr)["3rd Qu."][[1]], max(pr)), labels=c("A", "B", "C", "D"))

car::leveneTest(resid(model.post.pre),group=pr_cat2)
```

```{r eval=FALSE, include=FALSE}
outlierTest(model.post.pre.glm)
```

```{r include=FALSE}
table21 <- t(data.frame(c("-3.106003", "0.0018963", "0.17636")))
rownames(table21) <- c("21")
colnames(table21) <- c("Rstudent", "Unadjusted p-value","Bonferroni p")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table21, align= c('c', 'c','c'), caption = "Outlier test for the Post vs Pre model",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 8) %>%
  row_spec(0, bold=T, color= "black")
```

\newpage

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=5,  tinytex.verbose=TRUE, comment=NA, fig.cap="Diagnostic plots for the Post vs Pre model"}
influenceIndexPlot(model.post.pre.glm,vars=c("Cook", "Student","hat"), id=list(n=5))
```

Second, to validate the _5d vs Post_ model, the graphic of residuals versus fitted values serves to assess heteroscedasticity. In this case, there seems to be a slightly heteroscedastic pattern (Figure 33). Despite that, a Levene test is done. The resulted p-value is 0.40; this result lead to the non-rejection region of the null hypothesis. Consequently, homoscedasticity can be assumed.

Figure 34 shows that observations 45 and 8 have the highest Cook’s distance and studentized residuals and the observations 12 and 21 have the highest hat-values. Because of this, an outlier test is provided, showing that observation 21 should be considered an outlier (Table 22).

&nbsp;

```{r include=FALSE}
table22 <- t(data.frame(c("3.786826", "0.00015258", "0.011139")))
rownames(table22) <- c("8")
colnames(table22) <- c("Rstudent", "Unadjusted p-value","Bonferroni p")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table22, align= c('c', 'c','c'), caption = "Outlier test for the 5d vs Post model",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 8) %>%
  row_spec(0, bold=T, color= "black")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=3,  tinytex.verbose=TRUE, comment=NA, fig.cap="Residuals vs fitted values for 5d vs Post model", result='asis'}
residualPlot(model.5d.post.glm)
```

```{r eval=FALSE, include=FALSE}
pr <- predict(model.5d.post, type="response")
quantile(pr, probs=c(0.25, 0.50, 0.75))
pr_cat2 <- cut(pr, breaks=c(min(pr), summary(pr)["1st Qu."][[1]], summary(pr)["Median"][[1]],summary(pr)["3rd Qu."][[1]], max(pr)), labels=c("A", "B", "C", "D"))

car::leveneTest(resid(model.5d.post),group=pr_cat2)
```

```{r eval=FALSE, include=FALSE}
outlierTest(model.5d.post.glm)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=5,  tinytex.verbose=TRUE, comment=NA, fig.cap="Diagnostic plots for the 5d vs Post model"}
influenceIndexPlot(model.5d.post.glm,vars=c("Cook", "Student","hat"), id=list(n=5))
```

\newpage

Last, to validate the _5d vs Pre_ model,  the graphic of residuals versus fitted values serves to assess heteroscedasticity. In this case, there seems to be a slightly heteroscedastic pattern (Figure 35). Although, the Levene test is done. The resulted p-value is 0.43. This result lead to the non-rejection region of the null hypothesis. 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=3,  tinytex.verbose=TRUE, comment=NA, fig.cap="Residuals vs fitted values for 5d vs Pre model", result='asis'}
residualPlot(model.5d.pre.glm)
```

&nbsp;

Figure 36 shows that the observation 8 has the highest Cook's distance and studentized residuals and observation 16 has the highest hat-values in this model. Consequently, an outlier test is done, showing that observation 8 should be considered an outlier (Table 23).


```{r eval=FALSE, include=FALSE}
pr <- predict(model.5d.pre, type="response")
quantile(pr, probs=c(0.25, 0.50, 0.75))
pr_cat2 <- cut(pr, breaks=c(min(pr), summary(pr)["1st Qu."][[1]], summary(pr)["Median"][[1]],summary(pr)["3rd Qu."][[1]], max(pr)), labels=c("A", "B", "C", "D"))

car::leveneTest(resid(model.5d.pre),group=pr_cat2)
```

```{r eval=FALSE, include=FALSE}
outlierTest(model.5d.pre.glm)
```

```{r include=FALSE}
table23 <- t(data.frame(c("4.335399", "1.455e-05", "0.0010621")))
rownames(table23) <- c("8")
colnames(table23) <- c("Rstudent", "Unadjusted p-value","Bonferroni p")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table23, align= c('c', 'c','c'), caption = "Outlier test for the 5d vs Pre model",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 8) %>%
  row_spec(0, bold=T, color= "black")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.height=5,  tinytex.verbose=TRUE, comment=NA, fig.cap="Diagnostic plots for the 5d vs Pre model", fig.pos='H'}
influenceIndexPlot(model.5d.pre.glm,vars=c("Cook", "Student","hat"), id=list(n=5))
```

To sum up, the forest plots of the _Post vs Pre_, the _5d vs Post_ and _5d vs Pre_ models are shown in figures 37, 38 and 39.

```{r include=FALSE}
# POST VS PRE
res1.e<-confint(glht(model.post.pre.glm, linfct=t(c(0,1,0,0,0)))) #V_pre
res2.e<-confint(glht(model.post.pre.glm, linfct=t(c(0,0,1,0,0)))) #Num_passes
res3.e<-confint(glht(model.post.pre.glm, linfct=t(c(0,0,1,0,1))))

# 5D VS POST
res1.l<-confint(glht(model.5d.post.glm, linfct=t(c(0,1,0))))
res2.l<-confint(glht(model.5d.post.glm, linfct=t(c(0,0,1))))

# 5D VS PRE
res1.t<-confint(glht(model.5d.pre.glm, linfct=t(c(0,1,0,0,0))))
res2.t<-confint(glht(model.5d.pre.glm, linfct=t(c(0,1,0,0,1))))
res3.t<-confint(glht(model.5d.pre.glm, linfct=t(c(0,0,0,1,0))))
```

```{r include=FALSE}
table_resum1_col1 <- c(as.numeric(res1.e$confint[1]),
              as.numeric(res2.e$confint[1]),
              as.numeric(res3.e$confint[1]))

table_resum1_col2 <- c(as.numeric(res1.e$confint[2]),
              as.numeric(res2.e$confint[2]),
              as.numeric(res3.e$confint[2]))

table_resum1_col3 <- c(as.numeric(res1.e$confint[3]),
              as.numeric(res2.e$confint[3]),
              as.numeric(res3.e$confint[3]))

table_resum1_col4 <- c("Inf. volume pre EVT", "Number of passes:TICI<2b", "Number of passes:TICI>=2b")

table_resum1 <- data.frame(table_resum1_col4,table_resum1_col1,table_resum1_col2,table_resum1_col3)
colnames(table_resum1) <- c("Variable","Mean", "Lower", "Upper")
```

```{r echo=FALSE, fig.align="center",fig.height=2.5, fig.pos='H', message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Forest plot of Post vs Pre model"}
par(font=1, cex=0.75)
forest(x=table_resum1$Mean,
       ci.lb=table_resum1$Lower,
       ci.ub=table_resum1$Upper,
       slab=table_resum1$Variable,
       pzise=0.75, refline=0, cex=1, efac=0.75, xlab="Additive increase in infarct volume pre",
       header=c("Post vs Pre model", "Estimate [95% CI]"))
```

```{r include=FALSE}
table_resum2_col1 <- c(as.numeric(res1.l$confint[1]),
              as.numeric(res2.l$confint[1]))

table_resum2_col2 <- c(as.numeric(res1.l$confint[2]),
              as.numeric(res2.l$confint[2]))

table_resum2_col3 <- c(as.numeric(res1.l$confint[3]),
              as.numeric(res2.l$confint[3]))

table_resum2_col4 <- c("Inf. volume post EVT", "Occlusion post")

table_resum2 <- data.frame(table_resum2_col4,table_resum2_col1,table_resum2_col2,table_resum2_col3)
colnames(table_resum2) <- c("Variable","Mean", "Lower", "Upper")
```

```{r echo=FALSE, fig.align="center", fig.height=2.5, fig.pos='H', message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Forest plot of 5d vs Post model"}
par(font=1, cex=0.75)
forest(x=table_resum2$Mean,
       ci.lb=table_resum2$Lower,
       ci.ub=table_resum2$Upper,
       slab=table_resum2$Variable,
       pzise=0.75, refline=0, cex=1, efac=0.75, xlab="Additive increase in infarct volume on day 5",
       header=c("5d vs Post model", "Estimate [95% CI]"))
```

```{r include=FALSE}
table_resum3_col1 <- c(as.numeric(res1.t$confint[1]),
              as.numeric(res2.t$confint[1]),
              as.numeric(res3.t$confint[1]))

table_resum3_col2 <- c(as.numeric(res1.t$confint[2]),
              as.numeric(res2.t$confint[2]),
              as.numeric(res3.t$confint[2]))

table_resum3_col3 <- c(as.numeric(res1.t$confint[3]),
              as.numeric(res2.t$confint[3]),
              as.numeric(res3.t$confint[3]))

table_resum3_col4 <- c("Inf. volume pre EVT:TICI<2b", "Inf. volume pre EVT:TICI>=2b", "Occlusion post")

table_resum3 <- data.frame(table_resum3_col4,table_resum3_col1,table_resum3_col2,table_resum3_col3)
colnames(table_resum3) <- c("Variable","Mean", "Lower", "Upper")
```

```{r echo=FALSE, fig.align="center", fig.height=2.5, fig.pos='H', message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Forest plot of 5d vs Pre model"}
par(font=1, cex=0.75)
forest(x=table_resum3$Mean,
       ci.lb=table_resum3$Lower,
       ci.ub=table_resum3$Upper,
       slab=table_resum3$Variable,
       pzise=0.75, refline=0, cex=1, efac=0.75, xlab="Additive increase in infarct volume on day 5",
       header=c("5d vs Pre model", "Estimate [95% CI]"))
```

&nbsp;

## Mixed model

Mixed models provide an analytical power that cannot be achieved using general or generalized linear models because they consider the correlations between the measure corresponding the same patient @mixtos. A mixed model with random intercepts was fitted to the data (showed below) and more detailed information about this model is included in the Appendix 4.

Table 24 shows the estimations and the 95% CI of the parameters of fixed effects. Even though, for random intercepts, it shows the standard deviation. 

\newpage


```{r message=FALSE, warning=FALSE, comment=F, include=FALSE}
row1 <- c(rep(1,4),0,0,0)
row2 <- rep(0,7)
m <- matrix(c(rep(row1,4), rep(row2,3)), ncol=7, byrow=T)
diag(m)=0

dades3 <- d[c(1, 14, 17, 16, 2, 3, 4)]
imp_mixed <- mice(dades3, predictorMatrix=m, method=c(rep("pmm",4),"","",""))
imp_data <- complete(imp_mixed)

d_melted_imp <- melt(imp_data, id=c("ID_FURIAS", "TICI_equal_higher2B", "num_passes", "imaging_recan"))
colnames(d_melted_imp)[1] <- c("subject")
colnames(d_melted_imp)[5] <- c("time")
colnames(d_melted_imp)[6] <- c("volume")
summary(d_melted_imp)

lmeModel = lmer(volume~ (1|subject) + num_passes*TICI_equal_higher2B + imaging_recan*TICI_equal_higher2B + time*TICI_equal_higher2B , data=d_melted_imp)
Anova(lmeModel)
summary(lmeModel)

lmeModel1 = lmer(volume~ (1|subject) + num_passes*TICI_equal_higher2B + imaging_recan + time*TICI_equal_higher2B , data=d_melted_imp)
Anova(lmeModel1)
anova(lmeModel1, lmeModel, test="F")

lmeModel2 = lmer(volume~ (1|subject) + num_passes*TICI_equal_higher2B + time*TICI_equal_higher2B , data=d_melted_imp)
Anova(lmeModel2)
anova(lmeModel2, lmeModel1, test="F")

summary(lmeModel2)
emmeans(lmeModel2, list(pairwise~time), adjust="bonferroni")

qqnorm(resid(lmeModel2))
plot(lmeModel2)

# LOGS DELS VOLUMS:

dades4 <- d[c(1, 14, 17, 16, 63, 64, 65)]
imp_mixed <- mice(dades4, predictorMatrix=m, method=c(rep("pmm",4),"","",""))
imp_data <- complete(imp_mixed)

d_melted_imp2 <- melt(imp_data, id=c("ID_FURIAS", "TICI_equal_higher2B", "num_passes", "imaging_recan"))
colnames(d_melted_imp2)[1] <- c("subject")
colnames(d_melted_imp2)[5] <- c("time")
colnames(d_melted_imp2)[6] <- c("volume")
summary(d_melted_imp2)

lmeModel2_bis = lmer(volume~ (1|subject) + num_passes + time*TICI_equal_higher2B , data=d_melted_imp2)
Anova(lmeModel2_bis)
summ(lmeModel2_bis, confint=T)

plot(lmeModel2_bis)
```

```{r include=FALSE}
table24_col1 <- c("Number of passes", "Time Log(Infarct volume post EVT)", "Time Log(Infarct volume 5d)", "TICI>=2B", "Time Log(Infarct volume post EVT):TICI>=2B","Time Log(Infarct volume 5d):TICI>=2B", "Subject")

table24_col2 <- c("0.17 [0.03, 0.31]", "1.96 [1.45, 2.47]", "2.72 [2.14, 3.29]", "0.63 [-0.12, 1.38]", "-1.73 [-2.28, -1.19]", "-2.1 [-2.72, -1.48]", "")

table24_col3 <- c("", "", "", "", "", "", "1.09")

table24 <- data.frame(table24_col1, table24_col2, table24_col3)
colnames(table24) <- c("", "Estimate", "Std. Dev.")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA}
kable(table24, align= c('l', 'c', 'c'), caption = "Coefficient point estimates and 95\\%  CI of the mixed model",
      booktabs = T, linesep="") %>%
  kable_styling(latex_options = c("hold_position"), font_size = 10) %>%
  row_spec(0, bold=T, color= "black") %>%
  pack_rows(index=c("Fixed Effects"=6, "Random Effects"=1))
# %>%column_spec(1, width = "2.75cm")
```

```{r include=FALSE}
res1.e<-confint(glht(lmeModel2_bis, linfct=t(c(0,1,0,0,0,0,0))))
exp(as.numeric(res1.e$confint))

res2.e<-confint(glht(lmeModel2_bis, linfct=t(c(0,0,1,0,0,0,0))))
exp(as.numeric(res2.e$confint))^log(1.1)
res3.e<-confint(glht(lmeModel2_bis, linfct=t(c(0,0,1,0,0,1,0))))
exp(as.numeric(res3.e$confint))^log(1.1)

res4.e<-confint(glht(lmeModel2_bis, linfct=t(c(0,0,0,1,0,0,0))))
exp(as.numeric(res4.e$confint))^log(1.1)
res5.e<-confint(glht(lmeModel2_bis, linfct=t(c(0,0,0,1,0,0,1))))
exp(as.numeric(res5.e$confint))^log(1.1)
```

For instance, a one unit increase in the predictor number of passes corresponds to a 18.5% [3.41%, 35.79%] increase in the outcome infarct volume. Likewise, an increase of 10% in the infarct volume post EVT is related to a punctual increase of 20.53% [14.85%, 26.5%] in the outcome infarct volume if TICI grades are less than 2b. However, it is associated with an increase of 2.16% [0.12%, 4.25%] if TICI grades are equal or greater than 2b.

Additionally, an increase of 10% in the infarct volume on day 5 is related to a punctual increase of 29.56% [22.66%, 36.86%] in the outcome infarct volume if TICI grades are less than 2b. Even so, it is associated with an increase of 6.06% [3.81%, 8.36%] if TICI grades are equal or greater than 2b.

The correlations of the fixed effects can also be seen in the Appendix 4.


```{r include=FALSE}
table_resum1_col1 <- c(exp(as.numeric(res1.e$confint[1])),
              exp(as.numeric(res2.e$confint[1]))^log(1.1),
              exp(as.numeric(res3.e$confint[1]))^log(1.1),
              exp(as.numeric(res4.e$confint[1]))^log(1.1),
              exp(as.numeric(res5.e$confint[1]))^log(1.1))

exp(as.numeric(res1.e$confint))^log(1.1)

table_resum1_col2 <- c(exp(as.numeric(res1.e$confint[2])),
              exp(as.numeric(res2.e$confint[2]))^log(1.1),
              exp(as.numeric(res3.e$confint[2]))^log(1.1),
              exp(as.numeric(res4.e$confint[2]))^log(1.1),
              exp(as.numeric(res5.e$confint[2]))^log(1.1))

table_resum1_col3 <- c(exp(as.numeric(res1.e$confint[3])),
              exp(as.numeric(res2.e$confint[3]))^log(1.1),
              exp(as.numeric(res3.e$confint[3]))^log(1.1),
              exp(as.numeric(res4.e$confint[3]))^log(1.1),
              exp(as.numeric(res5.e$confint[3]))^log(1.1))

table_resum1_col4 <- c("Number of passes", "log(Inf. vol. post EVT):TICI<2b", "log(Inf. vol. post EVT):TICI>=2b", "log(Inf. vol. 5d):TICI<2b","log(Inf. vol. 5d):TICI>=2b")

table_resum1 <- data.frame(table_resum1_col4,table_resum1_col1,table_resum1_col2,table_resum1_col3)
colnames(table_resum1) <- c("Variable","Mean", "Lower", "Upper")
```

To validate this model, the graphic of residuals versus fitted values is used. There seems to be a homoscedastic pattern and linearity because the residuals have no obvious patterns or systematic structure (Figure 40). 

```{r echo=FALSE, fig.align="center", fig.cap="Residuals vs fitted values for the mixed model", fig.height=3, message=FALSE, warning=FALSE, comment=NA, result='asis', tinytex.verbose=TRUE}
plot(lmeModel2_bis, xlab="Fitted values", ylab="Pearson residuals", col="black")
```

To sum up, the forest plot of this model is shown in figure 41. It is important to mention that an increase of 10% is shown for the logarithm of the infarct volumes in this plot.

```{r echo=FALSE, fig.align="center",fig.height=2.5, fig.pos='H', message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Forest plot of the mixed model"}
par(font=1, cex=0.75)
forest(x=table_resum1$Mean,
       ci.lb=table_resum1$Lower,
       ci.ub=table_resum1$Upper,
       slab=table_resum1$Variable,
       pzise=0.75, refline=0, cex=1, efac=0.75, xlab="Multiplicative increase in the infarct volume",
       header=c("Mixed model", "Estimate [95% CI]"))
```

\newpage

# Discussion

## Main findings

The relevant factors found in each model are provided in the following table:

```{r include=FALSE}
findings_col1 <- c("HIR pre","Infarct volume pre EVT", "Infarct volume post EVT", "Number of passes", "Occlusion post","Time image to recanalization", "TMax6 volume post")

findings_col2 <- c("x", "R", "-", "X", "", "", "")
findings_col3 <- c("", "X", "-", "X", "", "X", "")
findings_col4 <- c("", "x", "-", "X", "", "", "")

findings_col5 <- c("", "-", "R", "", "", "X", "X")
findings_col6 <- c("", "-", "X", "", "", "", "X")
findings_col7 <- c("", "-", "x", "", "x", "", "")

findings_col8 <- c("", "R", "-", "", "", "X", "X")
findings_col9 <- c("", "X", "-", "x", "", "", "X")
findings_col10 <-c("", "X", "-", "", "x", "", "")

findings_col11 <- c("", "R", "R", "x", "", "", "")

findings <- data.frame(findings_col1, findings_col2,findings_col3,findings_col4,findings_col5,findings_col6,findings_col7,findings_col8,findings_col9,findings_col10,findings_col11)
colnames(findings) <- c("Variables", "Early", "Post vs Pre\n(lm)", "Post vs Pre\n(glm)", "Late", "5d vs Post\n(lm)", "5d vs Post\n(glm)", "Total", "5d vs Pre\n(lm)", "5d vs Pre\n(glm)", "Mixed")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center', tinytex.verbose = TRUE, comment = NA, fig.height = 4,fig.width = 7}
kable(findings,booktabs = T, row.names = FALSE, align = c("l","c", "c", "c","c", "c", "c", "c", "c", "c", "c"), linesep="") %>%
  kable_styling(font_size = 8, latex_options = c("hold_position", "scale_down","striped"), stripe_index = c(1,3,5,7), position = "center") %>%
  column_spec(1, width = "2.75cm") %>%
  footnote(number=c("Uppercase X indicates when interaction with TICI grade is relevant", "Uppercase R indicates that the corresponding infarct volume is used in the response variable, not as a covariate", "- indicates that the corresponding infarct volume was not considered"))
```

The main findings were obtained through the general linear model using infarct volumes and the mixed model because they are the most consistent and reliable models done in this end-of-degree project.

The most relevant factors associated with the increase of the infarct volume post EVT are the infarct volume pre EVT, the number of passes and the time image to recanalization. Increasing the infarct volume pre EVT, is always related to an increase in the infarct volume post EVT. However, it tends to increase more for patients with TICI grade greater than or equal to 2b than for the rest of the patients.

Furthermore, rising one pass of the catheter to achieve target vessel recanalization in the mechanical thrombectomy, is always related to a significant increase of the infarct volume post EVT. Nevertheless, it tends to increase more for patients with TICI grade less than 2b rather than for those with TICI grade greater than or equal to 2b.

Besides, an increase of five minutes in the time image to recanalization is associated with an increase in the early infarct growth in patients with TICI grade less than 2b, but a decrease in patients TICI grade is greater than or equal to 2b. This might be because when patients do not recanalize spending five more minutes in time image recanalization is not going to affect the infarct volume post EVT. 

The most relevant factor associated with the increase of the infarct volume on day 5 is the variable TMax6 volume post. An increase of this variable is related to a significant increase in infarct volume on day 5 in patients with TICI grades greater than or equal to 2b.

Nonetheless, all these results must be interpreted with caution and a number of limitations should be borne in mind.

## Limitations

The findings of this study have to be seen in light of some limitations. First, the number of patients with TICI grades less than 2b is too small, only 14 patients did not recanalize. For this reason, it was difficult to find significant relationships from this group and the assumption of Normal distribution required for most of statistical tests cannot be assessed with lower sample sizes.

Second, there are some missing values in the infarct volumes, especially in the infarct volume on day 5 because some patients died within 5 days after the procedure, which is when the third MRI is performed. These missing data may introduce some kind of bias as well as a loss of statistical power and precision. Models done with imputed missing values and adjusting for all volumes decrease the risk of biased results.


Finally, in the multivariate generalized linear models, variables that caused convergence problems with the model are not included, which could imply that some relevant factors might have been ignored.

## Conclusion

To conclude, rising one pass of the catheter to achieve target vessel recanalization in the mechanical thrombectomy, corresponds to a significant increase in the outcome infarct volume. This result seems reasonable since a greater number of passes during surgery is associated with more difficulties in controlling the infarct volume. As the relationship between the number of passes and the growth of the infarct volume is more marked in patients with a TICI less than 2b, in these patients the convenience of increasing the number of passes should be assessed through an experimental study. Also, increasing one unit the variable TMax6 volume post is associated with an increase of the final infarct size but only in patients that do recanalize. Unlike the number of passes, the researcher has no control over the variable Tmax6, since this can be seen as a result of the procedure. This implies that the association found has relevance from a predictive point of view, that is, it allows anticipating the infarcted volume on 5 days, but it cannot be modified to improve the patient's evolution.

Finally, future research should focus on re-analyzing new data with more patients, especially with ones that do not recanalize, in other words, with TICI less than 2b.

\newpage

# Appendix

## Appendix 1: Descriptive analysis

```{r include=FALSE, comment=F, message=F, warning=F}
d_melted3 <- melt(d[c(1,5,6,62)], id.vars=c("ID_FURIAS", "Total_infarct_growth"))
colnames(d_melted3)[1] <- c("id")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.height=3.25, fig.width=6, fig.cap="Scatter plot of total infarct growth, according to early and late infarct growth"}
my_blue <- brewer.pal(n = 9, "Blues")[c(6,9)]

g1 <-ggplot(d_melted3, aes(x=value, y=Total_infarct_growth, group=variable,
                      colour=variable)) +
  scale_colour_manual(values=my_blue, name="", labels=c("Early infarct growth",
                                                        "Late infarct growth")) +
  geom_point()+
  geom_smooth(method=lm)+ 
  labs(title="", x="mL", y="Total infarct growth") +
  scale_fill_brewer(palette="Blues")+ theme(legend.position="bottom")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.height=3, fig.width=6, fig.cap="A scatter plot of total infarct growth, according to early infarct growth, stratified by TICI grade"}
g2 <- ggplot(d, aes(x=Early_infarct_growth, y=Total_infarct_growth, group=factor(TICI_equal_higher2B),
                      colour=factor(TICI_equal_higher2B))) +
  scale_colour_manual(values=brewer.pal(9, "Blues")[c(9,6)], name="", labels=c("TICI<2b",
                                                        "TICI>=2b")) +
  geom_point()+
  geom_smooth(method=lm)+ xlim(-25, 125) +
  labs(title="", x="Early infarct growth", y="Total infarct growth")+ theme(legend.position="bottom")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.height=3, fig.width=6, fig.cap="A scatter plot of total infarct growth, according to late infarct growth, stratified by TICI grade"}
g3 <- ggplot(d, aes(x=Late_infarct_growth, y=Total_infarct_growth, group=factor(TICI_equal_higher2B),
                      colour=factor(TICI_equal_higher2B))) +
  scale_colour_manual(values=brewer.pal(9, "Blues")[c(9,6)], name="", labels=c("TICI<2b",
                                                        "TICI>=2b")) +
  geom_point()+
  geom_smooth(method=lm)+ 
  labs(title="", x="Late infarct growth", y="Total infarct growth")+ theme(legend.position="bottom")
```

```{r echo=FALSE, fig.align="center", fig.height=6,fig.width=7, message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE, fig.cap="Scatter plots of the infarct growths", result='asis'}
require(gridExtra)

grid.arrange(g1, arrangeGrob(g2,g3, ncol=2), nrow=2)
```

The first graph in figure 1 shows that early infarct growth has more influence to the total infarct growth than late infarct growth. That is because early infarct growth has a bigger slope.

Moreover, the left graph shows that the slope is quite similar between these two groups. However, there is a different intercept. This means that a patient without differences between pre and post-procedure infarct volumes will have more difference in the total infarct growth if the TICI grade is less than 2b. Also, the right graph shows that there is a different intercept. This means that a patient without differences between pre and post-procedure infarct volumes will have more difference in the total infarct growth if the TICI grade is less than 2b.

\newpage

```{r message=FALSE, warning=FALSE, include=FALSE}
d_melted <- melt(d[c(1,2,3,4,9)], id.vars=c("ID_FURIAS", "tici_fin"))
colnames(d_melted)[1] <- c("id")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.height=3, fig.width=6, fig.cap="Infarct volumes for each patient stratified by TICI grade"}

ggplot(d_melted, aes(variable, value, group=factor(id), colour=tici_fin)) +
  geom_line() +
  theme(legend.position="none") + geom_point() + 
  labs(title="", y="mL", x="") + scale_x_discrete(labels=c("Pre", "Post", "5d"))+
  facet_wrap(.~tici_fin) + 
  scale_colour_manual(values = brewer.pal(9, "Blues")[c(9,8,7,6,5)]) 
```

## Appendix 2: General linear models

### Multivariate models with infarct growths

**Regression Model for early infarct growth**
```{r echo=FALSE, fig.align="center", fig.cap="Regression model for early infarct growth", message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE}
summ(Mod_Et, confint=T, vifs=F)
```

```{r include=FALSE}
table9 <- t(data.frame(round(car::vif(Mod_E1),2)))
rownames(table9) <- c("VIF")
```

```{r echo=FALSE}
kable(table9, align= c('c','c','c','c','c'), caption = "VIFs of regression model for early infarct growth", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position"),font_size=10,  stripe_index = c())
```

\newpage

**Regression Model for late infarct growth**
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.cap="Regression Model for late infarct growth"}
summ(Mod_Lt, confint=T)
```

```{r include=FALSE}
table6 <- t(data.frame(round(car::vif(Mod_L1),2)))
rownames(table6) <- c("VIF")
```

```{r echo=FALSE}
kable(table6, align= c('c','c','c','c','c'), caption = "VIFs of regression model for late infarct growth", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position"),  stripe_index = c(), font_size = 8)
```

**Regression Model for total infarct growth**
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.cap="Regression Model for total infarct growth"}
summ(Mod_Tt, confint = T, auto.label=T)
```

```{r include=FALSE}
table7 <- t(data.frame(round(car::vif(Mod_T1),2)))
rownames(table7) <- c("VIF")
```

```{r echo=FALSE}
kable(table7, align= c('c','c','c','c','c'), caption = "VIFs of regression model for total infarct growth", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position"),font_size=10,  stripe_index = c())
```

\newpage

### Multivariate models with infarct volumes

**Regression Model for Post vs Pre**
```{r echo=FALSE, fig.align="center", fig.cap="Regression model for early infarct growth", message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE}
summ(model.post.pre, confint=T, vifs=F)
```

```{r include=FALSE}
table9 <- t(data.frame(round(car::vif(fit4.1$analyses[[1]]),2)))
rownames(table9) <- c("VIF")
```

```{r echo=FALSE}
kable(table9, align= c('c','c','c','c','c'), caption = "VIFs of regression model for Post vs Pre", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position"),  stripe_index = c())
```

\newpage

**Regression Model for 5d vs Post**
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.cap="Regression Model for late infarct growth"}
summ(model.5d.post, confint=T)
```


```{r include=FALSE}
table9 <- t(data.frame(round(car::vif(m4.1$analyses[[1]]),2)))
rownames(table9) <- c("VIF")
```

```{r echo=FALSE}
kable(table9, align= c('c','c','c','c','c'), caption = "VIFs of regression model for Post vs Pre", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position"),  stripe_index = c(), font_size = 8)
```

**Regression Model for 5d vs Pre**
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.cap="Regression Model for total infarct growth"}
summ(model.5d.pre, confint = T, auto.label=T)
```

```{r include=FALSE}
table7 <- t(data.frame(round(car::vif(mod5.1$analyses[[1]]),2)))
rownames(table7) <- c("VIF")
```

```{r echo=FALSE}
kable(table7, align= c('c'), caption = "VIFs of regression model for 5d vs Pre", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"),font_size=8,  stripe_index = c())
```

\newpage

## Appendix 3: Generalized linear models

**Regression Model for Post vs Pre**
```{r echo=FALSE, fig.align="center", fig.cap="Regression model for early infarct growth", message=FALSE, warning=FALSE, comment=NA, tinytex.verbose=TRUE}
summ(model.post.pre.glm, confint=T, vifs=F)
```

```{r include=FALSE}
table9 <- t(data.frame(round(car::vif(mg.1$analyses[[1]]),2)))
rownames(table9) <- c("VIF")
```

```{r echo=FALSE}
kable(table9, align= c('c','c','c','c','c'), caption = "VIFs of regression model for Post vs Pre", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position"),font_size=10,  stripe_index = c())
```

\newpage

**Regression Model for 5d vs Post**
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.cap="Regression Model for late infarct growth"}
summ(model.5d.post.glm, confint=T, vifs=T)
```

**Regression Model for 5d vs Pre**
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", tinytex.verbose=TRUE, comment=NA, fig.cap="Regression Model for total infarct growth"}
summ(model.5d.pre.glm, confint = T, auto.label=T)
```

```{r include=FALSE}
table7 <- t(data.frame(round(car::vif(mg3.1$analyses[[1]]),2)))
rownames(table7) <- c("VIF")
```

```{r echo=FALSE, fig.pos='H'}
kable(table7, align= c('c','c','c','c','c'), caption = "VIFs of regression model for Post vs Pre", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position"),  stripe_index = c())
```

\newpage

## Appendix 4: Mixed model

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.pos='H', tinytex.verbose=TRUE, comment=NA, fig.cap="Mixed model for repeated measures analysis"}
summ(lmeModel2_bis, confint=T)
```

```{r echo=FALSE}
summary(lmeModel2_bis)
```


\clearpage
\newpage

# Bibliography














